var Visit=React.createClass({displayName:"Visit",getInitialState:function(){return{isSubmitting:!1,progress:0,confirmFinishVisitResponse:null,patients:{},resources:{},prescriptions:{}}},componentWillMount:function(){var e=this.props;if(e.hasOwnProperty("patients")&&null!==e.patients){var t={};for(var a in e.patients)t[a]=Utilities.applyGeneratedFields(e.patients[a]);this.setState({patients:t},function(){__debug(this.state.patients)}.bind(this))}},handleConfirmFinishVisit:function(e,t){var a=this.props;this.setState({isSubmitting:!0}),$("#visit-finish-modal").modal("hide").on("hidden.bs.modal",function(e){t.setState(t.getInitialState()),t.resetSelectState()}),$.ajax({type:"POST",url:"/visits/store",data:{_token:a._token,visit:a.visitID,patients:this.state.patients,stage:a.currentStage,destination:e},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.setState({progress:100*t})}}.bind(this),!1),e}.bind(this),success:function(e){this.setState(this.getInitialState())}.bind(this),error:function(e){},complete:function(e){this.setState({confirmFinishVisitResponse:e.responseJSON})}.bind(this)})},handlePatientAdd:function(e){var t=this.state.patients;t.hasOwnProperty(e.id)||(t[e.id]=Utilities.applyGeneratedFields(e),this.setState({confirmFinishVisitResponse:null,patients:t}))},handleFinishVisit:function(e){$("#visit-finish-modal").modal("show")},topLevelPatientStateChange:function(e,t,a){if(this.state.patients.hasOwnProperty(e)){var n=this.state.patients;patient=n[e],patient[t]=a,patient=Utilities.applyGeneratedFields(patient),this.setState({patients:n})}},topLevelStoreResource:function(e,t){var a=this.state.resources;a[e]=t,this.setState({resources:a})},render:function(){var e=this.props,t=this.state;return React.createElement("div",{className:"row"},React.createElement(Visit.FinishModal,{stages:e.stages,onConfirmFinishVisit:this.handleConfirmFinishVisit}),React.createElement(Visit.PatientsOverview,{fields:e.patientFields,patients:t.patients,mini:!1,resources:t.resources}),React.createElement(Visit.PatientsContainer,{_token:e._token,controlsType:e.controlsType,containerTitle:e.containerTitle,stageType:e.currentStageType,summaryFields:e.summaryFields,fields:e.mutableFields,patients:t.patients,prescriptions:t.prescriptions,isSubmitting:t.isSubmitting,progress:t.progress,confirmFinishVisitResponse:t.confirmFinishVisitResponse,onFinishVisit:this.handleFinishVisit,onPatientAdd:this.handlePatientAdd,onPatientDataChange:this.topLevelPatientStateChange,onStoreResource:this.topLevelStoreResource}))}});Visit.generatedFields={generatedHeader:{name:"Generated",type:"header"},age:{name:"Age",type:"number"}},Visit.PatientsOverview=React.createClass({displayName:"PatientsOverview",render:function(){var e,t,a=this.props,n=Object.keys(a.patients),i=n.length;return t=1==a.mini?jQuery.extend({},a.fields):jQuery.extend(jQuery.extend({},a.fields),Visit.generatedFields),delete t.first_name,delete t.last_name,delete t.photo,e=i>0?n.map(function(e,n){var i,s,l=a.patients[e];if(l.hasOwnProperty("photo")&&null!==l.photo){var r,c=a.hasOwnProperty("resources")?a.resources:{};try{r="string"==typeof l.photo?JSON.parse(l.photo):l.photo}catch(o){r=[]}if(r.length>0){var d=r[0];if(c.hasOwnProperty(d)){var m=c[d];s=React.createElement(Fields.Resource,{id:d,resource:{type:"image/jpeg",base64:m.data}})}else s=React.createElement(Fields.Resource,{id:r[0],resource:{type:"image/jpeg"}})}}return 0==a.mini&&(i=React.createElement("span",null,React.createElement("div",{className:"card-header"},React.createElement("span",{className:"label label-info"},"#",n+1),React.createElement("span",{className:"label label-default"},e)),React.createElement("div",{className:"card-block"},React.createElement("h4",{className:"card-title text-xs-center m-a-0"},React.createElement("strong",null,Utilities.getFullName(l)))),s)),React.createElement("div",{className:"card forcept-patient-summary",key:e},i,React.createElement("div",{className:"list-group list-group-flush"},Object.keys(t).map(function(e,n){var i,s=t[e],r=!1,c=Visit.generatedFields.hasOwnProperty(e),o="No data";if(l.hasOwnProperty(e)&&null!==l[e]&&l[e].length>0){var d=l[e];if(1!=a.mini||!c)if(-1!==["string","number"].indexOf(typeof d)){r=!0;var m=s.type;switch(m){case"textarea":o=React.createElement("p",{dangerouslySetInnerHTML:{__html:d.replace(/\n/g,"<br/>")}});break;case"multiselect":case"pharmacy":var u;try{u=JSON.parse(d)}catch(h){u=[]}Array.isArray(u)&&u.length>0&&(o=u.join(", "));break;case"file":break;default:o=d.toString()}}else Array.isArray(d)&&(r=!0,o=React.createElement("span",{className:"pull-right"},d.join(", ")))}return i=c?"➠":r?React.createElement("span",{className:"text-success"},"✓"):React.createElement("span",{className:"text-danger"},"✗"),"header"!=s.type?React.createElement("div",{className:"list-group-item",key:e+"-"+n},React.createElement("dl",null,React.createElement("dt",null,i,"   ",s.name),React.createElement("dd",null,r?o:""))):0==a.mini?React.createElement("div",{className:"list-group-item forcept-patient-overview-header-item",key:e+"-"+n},React.createElement("h5",{className:"text-center m-a-0"},s.name)):void 0}.bind(this))))}.bind(this)):React.createElement("div",{className:"alert alert-info hidden-sm-down"},"No patients within this visit."),1==a.mini?React.createElement("div",{className:"col-xs-12 col-lg-6"},e):React.createElement("div",{className:"col-xs-12 col-sm-12 col-md-4 col-xl-3"},e)}}),Visit.PatientsContainer=React.createClass({displayName:"PatientsContainer",getInitialState:function(){return{showImportBlock:!1,isLoading:!1}},isLoading:function(e){this.setState({isLoading:e})},onFinishVisit:function(){this.isLoading(!0),this.props.onFinishVisit(this.isLoading(!1))},handlePatientAddfromScratch:function(){this.isLoading(!0),$.ajax({type:"POST",url:"/patients/create",data:{_token:this.props._token},success:function(e){"success"==e.status&&this.props.onPatientAdd(e.patient)}.bind(this),error:function(e){},complete:function(){this.isLoading(!1)}.bind(this)})},handleShowImportBlock:function(){this.setState({showImportBlock:!0})},handleCloseImportBlock:function(){this.setState({showImportBlock:!1})},render:function(){var e,t,a,n=this.props,i=this.state,s=i.isLoading||n.isSubmitting,l=n.hasOwnProperty("patients")?n.patients:{},r=Object.keys(l),c=r.length;switch(n.isSubmitting?window.scrollTo(0,0):e=c>0?r.map(function(e,t){var a=l[e];return React.createElement("div",{key:e},React.createElement(Visit.Patient,{patient:a,id:e,index:t,fields:n.fields,summaryFields:n.summaryFields,onPatientDataChange:n.onPatientDataChange,onStoreResource:n.onStoreResource}),React.createElement("hr",null))}.bind(this)):React.createElement("div",{className:"alert alert-info"},"There are currently no patients in this visit."),i.showImportBlock&&(t=React.createElement(Visit.ImportBlock,{_token:n._token,onPatientAdd:n.onPatientAdd,onClose:this.handleCloseImportBlock})),n.controlsType){case"new-visit":a=React.createElement(Visit.NewVisitControls,{isLoading:s,isImportBlockVisible:i.showImportBlock,onFinishVisit:this.onFinishVisit,onPatientAddFromScratch:this.handlePatientAddfromScratch,onShowImportBlock:this.handleShowImportBlock});break;case"stage-visit":a=React.createElement(Visit.StageVisitControls,{isLoading:s,onFinishVisit:this.onFinishVisit})}var o;if(1==s)if(n.progress>0){var d=n.progress.toFixed(1);o=React.createElement("div",null,React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment...")),React.createElement("progress",{className:"progress progress-striped progress-animated",value:d,max:"100"},d,"%"))}else o=React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment..."));else{var m=n.confirmFinishVisitResponse;if(null!==m)if("success"==m.status){var u;"__checkout__"!==m.toStage&&(u=React.createElement("a",{href:"/visits/stage/"+m.toStage+"/handle/"+m.visitID,className:"btn btn-link"},"Follow this visit")),o=React.createElement("div",{className:"alert alert-success"},React.createElement("strong",null,"Awesome!")," ",m.message," ",u)}else{var h=m.errors.map(function(e,t){return React.createElement("li",{key:t},e)});o=React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"An error occurred:")," ",m.message,React.createElement("ul",null,h))}}return React.createElement("div",{className:"col-xs-12 col-sm-12 col-md-8 col-xl-9"},React.createElement("h1",{className:"p-t text-xs-center"},n.containerTitle),React.createElement("hr",null),o,e,t,a)}}),Visit.ImportBlock=React.createClass({displayName:"ImportBlock",getInitialState:function(){return{display:"form",patientsFound:[],name:null,forceptID:null,fieldNumber:null}},handleInputChange:function(e){return function(t){var a=this.state;a[e]=t.target.value,this.setState(a)}.bind(this)},handleSearch:function(e){this.setState({display:"searching"}),$.ajax({type:"POST",url:"/patients/search",data:{_token:this.props._token,by:e,"for":this.state[e]},success:function(e){this.setState({display:"results",patientsFound:e.patients})}.bind(this),error:function(e){},complete:function(e){}})},handlePatientAdd:function(e){return function(t){this.props.onPatientAdd(e),this.resetDisplay()}.bind(this)},resetDisplay:function(){this.setState(this.getInitialState())},doSearchName:function(){this.handleSearch("name")},doSearchForceptID:function(){this.handleSearch("forceptID")},doSearchFieldNumber:function(){this.handleSearch("fieldNumber")},render:function(){var e,t=this.state,a=this.props;switch(t.display){case"form":e=React.createElement("fieldset",{className:"form-group m-b-0"},React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by field number:"),React.createElement("div",{className:"input-group input-group-lg m-b"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search for a patient by field number...",value:t.fieldNumber,onChange:this.handleInputChange("fieldNumber")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.fieldNumber,onClick:this.doSearchFieldNumber},"Search"))),React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by Forcept ID:"),React.createElement("div",{className:"input-group input-group-lg m-b"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search for a patient by Forcept ID...",min:"100000",value:t.forceptID,onChange:this.handleInputChange("forceptID")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.forceptID,onClick:this.doSearchForceptID},"Search"))),React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by first or last name:"),React.createElement("div",{className:"input-group input-group-lg"},React.createElement("input",{type:"text",className:"form-control",placeholder:"Search for a patient by first or last name...",value:t.name,onChange:this.handleInputChange("name")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.name||0==t.name.length,onClick:this.doSearchName},"Search"))));break;case"searching":e=React.createElement("h2",null,React.createElement("img",{src:"/assets/img/loading.gif",className:"m-r"}),"One moment, searching patients..");break;case"results":e=0==t.patientsFound.length?React.createElement("div",{className:"alert alert-info"},"No patients found. ",React.createElement("a",{className:"alert-link",onClick:this.resetDisplay},"Try again?")):React.createElement("div",{className:"row"},t.patientsFound.map(function(e,t){var a;return null!==e.current_visit&&(a=React.createElement("li",{className:"list-group-item bg-danger"},"Patient currently in a visit!")),React.createElement("div",{className:"col-xs-12 col-sm-6",key:"patients-found-"+t},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-header"},React.createElement("h5",{className:"card-title"},React.createElement("span",{className:"label label-default pull-right"},e.id),React.createElement("span",{className:"label label-primary pull-right"},"#",t+1),React.createElement("span",{className:"title-content"},null!==e.full_name&&e.full_name.length>0?e.full_name:"Unnamed patient"))),React.createElement("ul",{className:"list-group list-group-flush"},a),React.createElement("div",{className:"card-block"},React.createElement("button",{type:"button",className:"btn btn-block btn-secondary",disabled:null!==e.current_visit,onClick:this.handlePatientAdd(e)},"+"," Add"))))}.bind(this)))}return React.createElement("blockquote",{className:"blockquote"},React.createElement("h3",null,"↯"," Import a patient",React.createElement("button",{type:"button",className:"close pull-right","aria-label":"Close",onClick:a.onClose},React.createElement("span",{"aria-hidden":"true"},"×"))),React.createElement("hr",null),e)}}),Visit.NewVisitControls=React.createClass({displayName:"NewVisitControls",render:function(){var e=this.props,t="m-x loading"+(0==e.isLoading?" invisible":"");return React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement("div",{className:"btn-group btn-group-lg p-b"},React.createElement("button",{type:"button",className:"btn btn-primary",disabled:e.isLoading,onClick:e.onPatientAddFromScratch},"+"," New"),React.createElement("button",{type:"button",className:"btn btn-default",disabled:e.isLoading||e.isImportBlockVisible,onClick:e.onShowImportBlock},"↯"," Import")),React.createElement("div",{className:"btn-group btn-group-lg"},React.createElement("img",{src:"/assets/img/loading.gif",className:t,width:"52",height:"52"}),React.createElement("button",{type:"button",className:"btn btn-success",disabled:e.isLoading,onClick:e.onFinishVisit},"✓"," Finish visit")))}}),Visit.StageVisitControls=React.createClass({displayName:"StageVisitControls",render:function(){var e=this.props,t="m-x"+(0==e.isLoading?" invisible":"");return React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement("div",{className:"btn-group btn-group-lg"},React.createElement("img",{src:"/assets/img/loading.gif",className:t,width:"52",height:"52"}),React.createElement("button",{type:"button",className:"btn btn-success",disabled:e.isLoading,onClick:e.onFinishVisit},"Finish visit »")))}}),Visit.Patient=React.createClass({displayName:"Patient",handleFieldChange:function(e,t){this.props.onPatientDataChange(this.props.id,e,t)},handleStoreResource:function(e,t){this.props.onStoreResource(e,t)},render:function(){var e,t=this.props,a=(this.state,t.fields),n=Object.keys(a),i=(n.length,t.summaryFields),s=Object.keys(i),l=s.length,r=null!==t.patient.full_name?t.patient.full_name:"Unnamed patient";if(null!==i&&"object"==typeof i&&l>0){var c={},o={},d={};d[t.patient.patient_id]=t.patient,s.map(function(e,t){t>(l-1)/2?o[e]=i[e]:c[e]=i[e]}.bind(this)),e=React.createElement("div",{className:"row"},React.createElement(Visit.PatientsOverview,{fields:c,patients:d,mini:!0}),React.createElement(Visit.PatientsOverview,{fields:o,patients:d,mini:!0}))}return React.createElement("blockquote",{className:"blockquote"},React.createElement("h3",null,React.createElement("span",{className:"label label-info"},"#",t.hasOwnProperty("index")?t.index+1:"?"),React.createElement("span",{className:"label label-default"},t.hasOwnProperty("id")?t.id:"?"),"  ",React.createElement("span",{className:"hidden-xs-down"},r),React.createElement("div",{className:"hidden-sm-up p-t"},r)),e,React.createElement("hr",null),n.map(function(e,n){var i=a[e],s=t.patient;switch(i.type){case"text":return React.createElement(Fields.Text,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"textarea":return React.createElement(Fields.Textarea,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"number":return React.createElement(Fields.Number,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"date":return React.createElement(Fields.Date,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"select":return React.createElement(Fields.Select,React.__spread({},i,{multiple:!1,defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"multiselect":return React.createElement(Fields.Select,React.__spread({},i,{multiple:!0,defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"file":return React.createElement(Fields.File,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,onStore:this.handleStoreResource,key:e,id:e}));case"yesno":return React.createElement(Fields.YesNo,React.__spread({},i,{defaultValue:s.hasOwnProperty(e)?s[e]:null,onChange:this.handleFieldChange,key:e,id:e}));case"header":return React.createElement(Fields.Header,React.__spread({},i,{key:e,id:e}));case"pharmacy":return React.createElement(Fields.Pharmacy,React.__spread({},i,{onChange:this.handleFieldChange,key:e,id:e}));default:return React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Warning:")," Unrecognized input type ",i.type)}}.bind(this)))}}),Visit.FinishModal=React.createClass({displayName:"FinishModal",getInitialState:function(){return{isSubmitting:!1}},onComplete:function(){this.setState({isSubmitting:!0}),this.props.onConfirmFinishVisit(this.state.destination,this)},handleDestinationChange:function(e){return function(t){this.setState({destination:e})}.bind(this)},componentWillMount:function(){this.resetSelectState()},resetSelectState:function(){var e=this.props;e.hasOwnProperty("stages")&&null!==e.stages&&e.stages.length>0?this.setState({destination:e.stages[0].id}):this.setState({destination:"__checkout__"})},render:function(){var e,t,a,n=this.props,i=this.state,s={};return n.hasOwnProperty("stages")&&n.stages.length>0&&(e=n.stages.map(function(e,t){return s[e.id]=e.name,React.createElement("label",{className:"btn btn-secondary btn-block"+(e.id==i.destination?" active":""),key:"finish-modal-option"+t,onClick:this.handleDestinationChange(e.id)},React.createElement("input",{type:"radio",name:"destination",defaultChecked:e.id==i.destination}),e.id==i.destination?"✓":""," ",e.name)}.bind(this))),t=1==i.isSubmitting?"Working...":"__checkout__"==i.destination?"Check-out patients":"Move patients to "+(null!==i.destination?s[i.destination]:s[a]),React.createElement("div",{className:"modal fade",id:"visit-finish-modal"},React.createElement("div",{className:"modal-dialog modal-sm",role:"document"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×")),React.createElement("h4",{className:"modal-title"},"Move visit to...")),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"btn-group-vertical btn-group-lg",style:{display:"block"},"data-toggle":"buttons"},e,React.createElement("label",{className:"btn btn-secondary btn-block"+("__checkout__"==i.destination?" active":""),onClick:this.handleDestinationChange("__checkout__")},React.createElement("input",{type:"radio",name:"destination",defaultChecked:"__checkout__"==i.destination}),"__checkout__"==i.destination?"✓":""," Check-out"))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-success",disabled:1==i.isSubmitting,onClick:this.onComplete},t)))))}});