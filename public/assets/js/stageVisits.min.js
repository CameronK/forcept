var StageVisits=React.createClass({displayName:"StageVisits",getInitialState:function(){return{isFetching:!0,visits:{}}},componentWillMount:function(){this.fetchVisits(),setInterval(function(){this.fetchVisits()}.bind(this),5e3)},fetchVisits:function(){$.ajax({type:"GET",url:"/visits/fetch/"+this.props.stage.id,success:function(e){e.hasOwnProperty("visits")?this.setState({visits:e.visits},function(){__debug(this.state)}.bind(this)):this.setState({visits:{}})}.bind(this),complete:function(e){this.setState({isFetching:!1})}.bind(this)})},render:function(){var e,t,a=Object.keys(this.state.visits);return e=a.length>0?a.map(function(e,t){var a=this.state.visits[e],l=a.patients.map(function(e,t){if(a.patient_models.hasOwnProperty(e.toString())){var l,s=a.patient_models[e.toString()],i="label-primary",c="Normal",n=function(){l=React.createElement("small",null,React.createElement("em",null,"No photo"))};if(s.hasOwnProperty("photo")&&null!==s.photo){var r=[];try{r=JSON.parse(s.photo)}catch(m){r=[]}Array.isArray(r)&&r.length>0?l=React.createElement(Fields.Resource,{id:r[0],resource:{type:"image/jpeg"},className:"thumbnail"}):n()}else n();if(s.hasOwnProperty("priority")&&null!==s.priority)switch(s.priority.toLowerCase()){case"high":c="High",i="label-warning";break;case"urgent":c="Urgent",i="label-danger"}var o=s.hasOwnProperty("full_name")?s.full_name:null,h=s.hasOwnProperty("birthday")?s.birthday:null,p=s.hasOwnProperty("created_at")?s.created_at:null,u=null!==o&&o.length>0?o:"Unnamed patient",d=null!==h&&h.length>0?Utilities.calculateAge(h):"Unknown",g=null!==p&&p.length>0?p:"Unknown";return React.createElement("div",{className:"col-xs-12 col-sm-6",key:"patient-row-"+e},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-block"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-4"},l),React.createElement("div",{className:"col-xs-12 col-sm-8 p-t text-xs-center text-sm-left"},React.createElement("div",null,React.createElement("span",{className:"label label-primary"},"#",t+1),React.createElement("span",{className:"label label-default"},e)),React.createElement("h4",{className:"forcept-stagevisits-patient-name"},u)))),React.createElement("ul",{className:"list-group list-group-flush"},React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-pill pull-right "+i},c),"Priority"),React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-primary label-pill pull-right"},d),"Age"),React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-primary label-pill pull-right"},g),"Created"))))}return React.createElement("div",{className:"col-sm-12 col-md-4",key:"patient-col-"+e},React.createElement("div",{className:"card"},React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Uh oh:")," an error occurred.",React.createElement("br",null),React.createElement("em",null,"Missing data for patient ",e))))}.bind(a));return React.createElement("blockquote",{className:"blockquote",key:"visit-"+t},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-8"},React.createElement("h2",null,React.createElement("label",{className:"label label-default","data-toggle":"tooltip","data-placement":"top",title:"Visit ID"},a.id),"  ",a.patients.length," patient",1==a.patients.length?"":"s")),React.createElement("div",{className:"col-xs-12 col-sm-4"},React.createElement("a",{href:"/visits/stage/"+this.props.stage.id+"/handle/"+a.id,className:"btn btn-primary btn-block btn-lg"},"Handle visit #",a.id," »"))),React.createElement("div",{className:"row m-t"},l),React.createElement("hr",{className:"m-b-0"}))}.bind(this)):React.createElement("div",{className:"alert alert-info"},"There are currently no visits in this stage."),this.state.isFetching&&(t=React.createElement("img",{src:"/assets/img/loading.gif"})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12"},React.createElement("h1",{className:"p-l text-xs-center"},this.props.stage.name,": ",this.state.visits.length," active visit",1==this.state.visits.length?"":"s"),React.createElement("hr",null),e,t))}});