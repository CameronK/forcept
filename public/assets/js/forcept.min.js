function __debug(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];"object"==typeof a&&null!==a&&(a=JSON.stringify(a,null,"  ")),e+=a+"<br/><br/>"}$("#forcept-debug-content pre").html(e)}function isTrue(e){switch(typeof e){case"boolean":return e===!0;case"string":return"true"===e;default:return!1}}function base64bytes(e){var t=e.split(",");return Math.round(.75*(t[1].length-t[0].length))}function getFileSize(e,t,a,s,n){return(t=t?[1e3,"k","B"]:[1024,"K","iB"],a=Math,s=a.log,n=s(e)/s(t[0])|0,e/a.pow(t[0],n)).toFixed(2)+" "+(n?(t[1]+"MGTPEZY")[--n]+t[2]:"Bytes")}var Utilities={calculateAge:function(e){var t=+new Date(e),a=Date.now(),s=null;if(a>t){var n=~~((a-t)/315576e5);if(0===n){var r=(a-t)/26298e5;s=0!==~~r?r.toFixed(1)+" months":"<1 month"}else s=n+" years"}return s},applyGeneratedFields:function(e){var t=null;"string"==typeof e.first_name&&"string"==typeof e.last_name&&e.first_name.length>0&&e.last_name.length>0?t=e.first_name+" "+e.last_name:("string"==typeof e.first_name&&e.first_name.length>0&&(t=e.first_name),"string"==typeof e.last_name&&e.last_name.length>0&&(t=e.last_name)),e.full_name=t;var a=null,s=e.birthday;return"string"==typeof s&&s.length>0&&(a=Utilities.calculateAge(s)),e.age=a,e},getFullName:function(e){if(e.hasOwnProperty("full_name")&&null!==e.full_name&&e.full_name.length>0)return e.full_name;var t=[];return e.hasOwnProperty("first_name")&&null!==e.first_name&&e.first_name.length>0&&t.push(e.first_name),e.hasOwnProperty("last_name")&&null!==e.last_name&&e.last_name.length>0&&t.push(e.last_name),t.length>0?t.join(" "):"Unnamed Patient"},isTrue:function(e){switch(typeof e){case"boolean":return e===!0;case"string":return"true"===e;default:return!1}}},Fields={labelColumnClasses:"col-lg-4 col-sm-5 col-xs-12",inputColumnClasses:"col-lg-8 col-sm-7 col-xs-12"};Fields.FieldLabel=React.createClass({displayName:"FieldLabel",render:function(){var e;return this.props.hasOwnProperty("description")&&null!==this.props.description&&this.props.description.length>0&&(e=React.createElement("div",null,React.createElement("small",{className:"text-muted"},this.props.description))),React.createElement("label",{htmlFor:this.props.id,className:Fields.labelColumnClasses+" form-control-label"},this.props.name,e)}}),Fields.Text=React.createClass({displayName:"Text",onTextInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("input",{type:"text",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onTextInputChange})))}}),Fields.Textarea=React.createClass({displayName:"Textarea",onTextareaInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("textarea",{className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onTextareaInputChange})))}}),Fields.Number=React.createClass({displayName:"Number",onNumberInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("input",{type:"number",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onNumberInputChange})))}}),Fields.Date=React.createClass({displayName:"Date",onDateInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("input",{type:"date",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onDateInputChange})))}}),Fields.Select=React.createClass({displayName:"Select",getInitialState:function(){return{isCustomDataOptionSelected:!1}},onSelectInputChange:function(e){var t=this.props;if(1==t.multiple){for(var a=e.target.options,s=[],n=0;n<a.length;n++)a[n].selected&&s.push(a[n].value);t.onChange(t.id,s)}else switch(e.target.value){case"__default__":this.setState({isCustomDataOptionSelected:!1}),t.onChange(t.id,"");break;case"__custom__":this.setState({isCustomDataOptionSelected:!0}),t.onChange(t.id,"");break;default:this.setState({isCustomDataOptionSelected:!1}),t.onChange(t.id,e.target.value)}},onCustomDataInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){var e,t,a,s,n,r,l,i=this.props,o=this.state;i.settings.hasOwnProperty("options")?(e=i.settings.options,t=Object.keys(e)):(e={},t=[]),0==i.multiple&&(n=React.createElement("option",{value:"__default__",disabled:"disabled"},"Choose an option…"),isTrue(i.settings.allowCustomData)&&(r=React.createElement("option",{value:"__custom__"},"Enter custom data for this field »")),isTrue(o.isCustomDataOptionSelected)&&(l=React.createElement("input",{type:"text",className:"form-control",placeholder:"Enter custom data here",onChange:this.onCustomDataInputChange}))),a=t.map(function(t,a){var s=!1,n=i.settings.options[t];return n.hasOwnProperty("available")&&(s="false"===n.available),React.createElement("option",{value:e[t].value,key:this.props.id+"-option-"+a,disabled:s},e[t].value)}.bind(this));var c=i.multiple?t.length>30?30:t.length:1;return s=React.createElement("select",{className:"form-control",onChange:this.onSelectInputChange,defaultValue:null!==i.defaultValue?i.defaultValue:i.multiple?[]:"__default__",multiple:i.multiple,size:c},n,a,r),React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},i)),React.createElement("div",{className:Fields.inputColumnClasses},s,l))}}),Fields.File=React.createClass({displayName:"File",getInitialState:function(){return{isUploading:!1,isParsing:!1,resources:[],files:[],uploadProgress:0,status:"",message:"",_storage:{}}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("defaultValue")&&null!==e.defaultValue&&Array.isArray(e.defaultValue)&&this.setState({resources:e.defaultValue})},onFileInputChange:function(e){this.setState({status:"",message:"",isParsing:!0});var t=e.target.files,a=t.length,s=[],n=function(){this.setState({files:s,isParsing:!1})}.bind(this);setTimeout(function(){for(var e=0;a>e;e++){var r=t[e],l=new FileReader,i=e;if(r.type.match("image.*")){var o=this.props.hasOwnProperty("maxWidth")?this.props.maxWidth:310,c=this.props.hasOwnProperty("maxHeight")?this.props.maxHeight:310;l.onload=function(e){var t=new Image;t.onload=function(e){var r=document.createElement("canvas"),l=t.width,u=t.height;l>u?l>o&&(u*=o/l,l=o):u>c&&(l*=c/u,u=c),r.width=l,r.height=u,r.getContext("2d").drawImage(t,0,0,l,u),s[i]=r.toDataURL("image/jpeg",.5),i+1==a&&n()},t.src=e.target.result},l.readAsDataURL(r)}else l.onload=function(e){s[i]=e.target.result},l.readAsDataURL(r)}}.bind(this),100)},handleUploadFiles:function(){this.setState({isUploading:!0,status:"",statusMessage:""});for(var e={},t=this.state,a=0;a<t.files.length;a++)e["file-"+a]=t.files[a];e._token=document.querySelector("meta[name='csrf-token']").getAttribute("value"),$.ajax({type:"POST",url:"/data/resources/upload",data:e,xhr:function(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total);this.setState({uploadProgress:t})}}.bind(this),!1),e}.bind(this),success:function(e){var t=e.hasOwnProperty("message")&&"object"==typeof e.message&&null!==e.message?e.message:{},s=Object.keys(t);this.setState({isUploading:!1,uploadProgress:0,files:[],resources:s,_storage:t,status:"success",message:"File(s) uploaded successfully!"},function(){var e=this.props;for(e.onChange(e.id,s),a=0;a<s.length;a++){var n=s[a];e.onStore(n,t[n])}}.bind(this))}.bind(this),error:function(e){this.setState({isUploading:!1,uploadProgress:0,status:"failure",message:"An error occurred during upload."})}.bind(this)})},handleRemoveResource:function(e){var t=this.state._storage,a=this.state.resources,s=a.indexOf(e);t.hasOwnProperty(e)&&delete t[e],-1!==s&&a.splice(s,1),this.setState({resources:a,_storage:t,status:"",message:""},function(){this.props.onChange(this.props.id,a)}.bind(this))},render:function(){var e,t,a=this.props,s=this.state,n=a.settings,r="",l=this.state.files,i=l.length,o=this.state.resources,c=this.state._storage,u=o.length;if(n.hasOwnProperty("accept")&&(r=n.accept.join()),s.status.length>0&&s.message.length>0){var p="success"==s.status?"success":"failure"==s.status?"danger":"info";t=React.createElement("div",{className:"alert alert-"+p},React.createElement("small",null,s.message))}if(u>0){var m=o.map(function(e,t){var a;return c.hasOwnProperty(e)&&c[e].hasOwnProperty("type")&&(a=c[e].type),React.createElement("div",{className:"list-group-item",key:["file-",e,"-",t].join()},React.createElement("span",{className:"label label-default m-r"},e),React.createElement("small",null,a),React.createElement("button",{onMouseUp:this.handleRemoveResource.bind(this,e),className:"close pull-right"},"×"))}.bind(this));e=React.createElement("div",{className:"card"},React.createElement("ul",{className:"list-group list-group-flush"},m))}else if(s.isUploading)e=React.createElement("div",null,React.createElement("h6",{className:"text-muted text-center m-t"},"Uploading ",i," ",1===i?"file":"files","..."),React.createElement("progress",{className:"progress",value:s.uploadProgress,max:100},React.createElement("div",{className:"progress"},React.createElement("span",{className:"progress-bar",style:{width:s.uploadProgress+"%"}},s.uploadProgress,"%"))));else{var d;(i>0||s.isParsing)&&(d=React.createElement("div",null,React.createElement("button",{type:"button",disabled:s.isParsing,className:"btn btn-sm btn-primary btn-block",onClick:this.handleUploadFiles},"⇑"," ",s.isParsing?"Preparing files...":"Upload"))),e=React.createElement("div",null,React.createElement("label",{className:"file"},React.createElement("input",{type:"file",className:"form-control",accept:r,onChange:this.onFileInputChange}),React.createElement("span",{className:"file-custom"},i>0?i+" files - ":"")),d)}return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},a)),React.createElement("div",{className:Fields.inputColumnClasses},e,t))}}),Fields.YesNo=React.createClass({displayName:"YesNo",getInitialState:function(){return{yes:null}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("defaultValue")&&null!==e.defaultValue&&-1!==["yes","no"].indexOf(e.defaultValue.toLowerCase())&&this.setState({yes:"yes"==e.defaultValue.toLowerCase()})},onYesNoInputChange:function(e){return function(t){this.setState({yes:e}),this.props.onChange(this.props.id,e?"Yes":"No")}.bind(this)},render:function(){var e=this.props,t=this.state;return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},e)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("div",{className:"btn-group btn-group-block","data-toggle":"buttons"},React.createElement("label",{className:"btn btn-primary-outline"+(1==t.yes?" active":""),onClick:this.onYesNoInputChange(!0)},React.createElement("input",{type:"radio",name:e.name+"-options",autoComplete:"off",defaultChecked:1==t.yes}),"Yes"),React.createElement("label",{className:"btn btn-primary-outline"+(0==t.yes?" active":""),onClick:this.onYesNoInputChange(!1)},React.createElement("input",{type:"radio",name:e.name+"-options",autoComplete:"off",defaultChecked:0==t.yes}),"No"))))}}),Fields.Header=React.createClass({displayName:"Header",render:function(){var e,t=this.props;return t.hasOwnProperty("description")&&null!==e&&(e=React.createElement("small",{className:"text-muted"},t.description)),React.createElement("div",{className:"form-group row"},React.createElement("h3",{className:"forcept-fieldset-header"},t.name," ",e),React.createElement("hr",null))}}),Fields.Pharmacy=React.createClass({displayName:"Pharmacy",getInitialState:function(){return{data:{}}},updateList:function(){$.ajax({type:"GET",url:"/data/pharmacy/drugs",success:function(e){"success"==e.status&&(__debug(e.data),this.setState({data:e.data}))}.bind(this),error:function(){},complete:function(){}})},componentWillMount:function(){this.updateList()},onSelectedDrugsChange:function(e){for(var t=e.target.options,a=[],s=0;s<t.length;s++)t[s].selected&&a.push(t[s].value);this.props.onChange(this.props.id,a)},render:function(){var e=this.props,t=this.state,a=Object.keys(this.state.data),s=React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment..."),React.createElement("div",null,"loading the latest pharmacy data"));return a.length>0&&(s=React.createElement("select",{className:"form-control forcept-field-select-drugs",multiple:!0,size:10,onChange:this.onSelectedDrugsChange},a.map(function(e,a){var s=t.data[e];if(s.hasOwnProperty("settings")&&s.settings.hasOwnProperty("options")&&null!==s.settings.options){var n=Object.keys(s.settings.options);return React.createElement("optgroup",{key:s.name,label:s.name},n.map(function(e,t){var a=s.settings.options[e],n="false"==a.available,r=a.value+(parseInt(a.count)>0&&a.available?"— "+a.count:"");return n?void 0:React.createElement("option",{value:a.value,key:t},r)}.bind(this)))}}.bind(this)))),React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},e)),React.createElement("div",{className:Fields.inputColumnClasses},s))}}),Fields.Resource=React.createClass({displayName:"Resource",getInitialState:function(){return{isFetching:!1,resource:{}}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("resource")&&null!==e.resource&&"object"==typeof e.resource&&(e.resource.hasOwnProperty("data")||this.fetchData(),this.setState({resource:e.resource}))},fetchData:function(){var e=this.props,t=this.state;this.setState({isFetching:!0}),$.ajax({method:"GET",url:"/data/resources/fetch?id="+e.id,success:function(e){var a=t.resource;a.type=e.type,a.base64=e.base64,this.setState({isFetching:!1,resource:a})}.bind(this),error:function(e){}.bind(this)})},render:function(){var e=this.props,t=this.state;resource=t.resource;var a,s=function(){a="Loading"};if(null!==resource&&"object"==typeof resource)if(t.isFetching)s();else if(resource.hasOwnProperty("type")){var n=resource.type;if(n.match("image/*"))if(resource.hasOwnProperty("base64"))try{a=React.createElement("img",{src:resource.base64})}catch(r){a="error!"}else s()}return React.createElement("div",{className:"forcept-patient-photo-contain "+(e.hasOwnProperty("className")?e.className:"")},a)}});