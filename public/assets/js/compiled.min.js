function __debug(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];"object"==typeof a&&null!==a&&(a=JSON.stringify(a,null,"  ")),e+=a+"<br/><br/>"}$("#forcept-debug-content pre").html(e)}function isTrue(e){switch(typeof e){case"boolean":return e===!0;case"string":return"true"===e;default:return!1}}function base64bytes(e){var t=e.split(",");return Math.round(.75*(t[1].length-t[0].length))}function getFileSize(e,t,a,s,n){return(t=t?[1e3,"k","B"]:[1024,"K","iB"],a=Math,s=a.log,n=s(e)/s(t[0])|0,e/a.pow(t[0],n)).toFixed(2)+" "+(n?(t[1]+"MGTPEZY")[--n]+t[2]:"Bytes")}var DataDisplays={setupDates:function(e){var t=new Date;t.setDate(t.getDate()-7),e.setState({from:t.toISOString().split(".")[0],to:(new Date).toISOString().split(".")[0]},function(){e.update()})}};DataDisplays.RangeModule=React.createClass({displayName:"RangeModule",render:function(){return React.createElement("div",{className:"row date-range"},React.createElement("div",{className:"col-xs-12 col-sm-6"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-addon"},"From"),React.createElement("input",{type:"datetime-local",className:"form-control",placeholder:"Date",value:this.props.from,onChange:this.props.onChangeFrom}))),React.createElement("div",{className:"col-xs-12 col-sm-6"},React.createElement("div",{className:"input-group"},React.createElement("span",{className:"input-group-addon"},"To"),React.createElement("input",{type:"datetime-local",className:"form-control",placeholder:"Date",value:this.props.to,onChange:this.props.onChangeTo}))))}}),DataDisplays.FlowOverview=React.createClass({displayName:"FlowOverview",getInitialState:function(){return{stages:{}}},update:function(){$.ajax({type:"GET",url:"/data/visits/count",data:{from:this.state.from,to:this.state.to},success:function(e){this.setState({stages:e.stages})}.bind(this),error:function(e){},complete:function(e){}})},componentWillMount:function(){DataDisplays.setupDates(this)},changeFromDate:function(e){this.setState({from:e.target.value})},changeToDate:function(e){this.setState({to:e.target.value})},render:function(){return React.createElement("blockquote",{className:"blockquote",id:"display-flow-overview"},React.createElement("h2",null,"Flow overview"),React.createElement("hr",null),React.createElement("div",{className:"row"},Object.keys(this.state.stages).map(function(e,t){return React.createElement("div",{className:"col-xs-12 col-sm-6 col-md-4",key:"flow-overview-stage-"+t},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-block"},React.createElement("h4",{className:"card-title text-xs-center m-b"},this.state.stages[e].name),React.createElement("hr",null),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-6 text-xs-center"},React.createElement("h2",null,React.createElement("span",{className:"label label-primary label-rounded"},this.state.stages[e].visits)),React.createElement("h5",{className:"text-muted"},"visit",1==this.state.stages[e].visits?"":"s")),React.createElement("div",{className:"col-xs-12 col-sm-6 text-xs-center"},React.createElement("h2",null,React.createElement("span",{className:"label label-primary label-rounded"},this.state.stages[e].patients)),React.createElement("h5",{className:"text-muted"},"patient",1==this.state.stages[e].patients?"":"s"))))))}.bind(this))),React.createElement("hr",null),React.createElement(DataDisplays.RangeModule,{from:this.state.from,to:this.state.to,onChangeFrom:this.changeFromDate,onChangeTo:this.changeToDate}))}}),DataDisplays.PatientAggregate=React.createClass({displayName:"PatientAggregate",getInitialState:function(){return{stages:[],charts:{}}},update:function(){$.ajax({type:"GET",url:"/data/patients/count",data:{from:this.state.from,to:this.state.to},success:function(e){var t={};e.stages.map(function(e){for(var a in e.data){var s=[];for(var n in e.data[a])s.push(e.data[a][n]);t[a]={chart:{type:"bar"},title:{text:"Fruit Consumption"},xAxis:{categories:Object.keys(e.data[a])},yAxis:{title:{text:"Fruit eaten"}},series:[{name:"Series 1",data:s}]}}}),this.setState({stages:e.stages,charts:t})}.bind(this),error:function(e){},complete:function(e){}})},componentWillMount:function(){DataDisplays.setupDates(this)},componentDidMount:function(){this.renderCharts()},componentDidUpdate:function(){this.renderCharts()},changeFromDate:function(e){this.setState({from:e.target.value})},changeToDate:function(e){this.setState({to:e.target.value})},renderCharts:function(){setTimeout(function(){for(var e in this.state.charts)$("#datadisplays-patient-aggregate-field-"+e).highcharts(this.state.charts[e])}.bind(this),5e3)},render:function(){var e;return e=this.state.stages.length>0?React.createElement("div",{className:"row"},this.state.stages.map(function(e,t){return React.createElement("div",{className:"col-xs-12 col-sm-6 col-md-4 col-lg-3",key:"patient-aggregate-stage-"+t},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-block"},React.createElement("h4",{className:"card-title text-xs-center"},e.name)),React.createElement("ul",{className:"list-group list-group-flush"},Object.keys(e.data).map(function(t){var a=e.data[t];return React.createElement("li",{className:"list-group-item data-points-list",key:"patient-aggregate-field-"+t},React.createElement("ul",{className:"list-unstyled"},React.createElement("li",{className:"bg-secondary"},React.createElement("h6",{className:"m-a-0"},e.fields[t].name)),Object.keys(a).map(function(e){var t;return t=e.length>0?e:React.createElement("em",null,"No data"),React.createElement("li",{className:"data-point-list-item text-xs-left"},t,React.createElement("span",{className:"label label-primary pull-right"},a[e]))})))}.bind(this)))))}.bind(this))):React.createElement("div",{className:"alert alert-info"},"No data found for this display within the specified time range."),React.createElement("blockquote",{className:"blockquote"},React.createElement("h2",null,"Patient aggregate data by stage"),React.createElement("hr",null),e,React.createElement("hr",null),React.createElement(DataDisplays.RangeModule,{from:this.state.from,to:this.state.to,onChangeFrom:this.changeFromDate,onChangeTo:this.changeToDate}))}});var Fields={labelColumnClasses:"col-lg-4 col-sm-5 col-xs-12",inputColumnClasses:"col-lg-8 col-sm-7 col-xs-12"};Fields.FieldLabel=React.createClass({displayName:"FieldLabel",render:function(){var e;return this.props.hasOwnProperty("description")&&null!==this.props.description&&this.props.description.length>0&&(e=React.createElement("div",null,React.createElement("small",{className:"text-muted"},this.props.description))),React.createElement("label",{htmlFor:this.props.id,className:Fields.labelColumnClasses+" form-control-label"},this.props.name,e)}}),Fields.Date=React.createClass({displayName:"Date",getInitialState:function(){return{broadMonthDetractor:null}},onBroadMonthSelectorChange:function(e){return function(t){var a=new Date;a.setMonth(a.getMonth()+e),this.setState({broadMonthDetractor:e});var s=[a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1,a.getDate(),a.getFullYear()].join("/");this.props.onChange(this.props.id,s)}.bind(this)},onDateInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){var e,t=this.props;if(t.hasOwnProperty("settings")&&t.settings.hasOwnProperty("useBroadMonthSelector")&&isTrue(t.settings.useBroadMonthSelector)){var a=[{name:"1 month ago",amount:-1},{name:"2 months ago",amount:-2},{name:"3 months ago",amount:-3},{name:"6 months ago",amount:-6},{name:"1 year ago",amount:-12}];e=React.createElement("div",{className:"btn-group btn-group-block","data-toggle":"buttons"},a.map(function(e,t){var a=this.state.broadMonthDetractor===e.amount;return React.createElement("label",{className:"btn btn-primary-outline"+(a?" active":""),onClick:this.onBroadMonthSelectorChange(e.amount)},React.createElement("input",{type:"radio",name:e.name+"-options",autoComplete:"off",defaultChecked:a}),e.name)}.bind(this)))}else e=React.createElement("input",{type:"date",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onDateInputChange});return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},e))}}),Fields.File=React.createClass({displayName:"File",getInitialState:function(){return{isUploading:!1,isParsing:!1,resources:[],files:[],uploadProgress:0,status:"",message:"",_storage:{}}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("defaultValue")&&null!==e.defaultValue&&Array.isArray(e.defaultValue)&&this.setState({resources:e.defaultValue})},onFileInputChange:function(e){this.setState({status:"",message:"",isParsing:!0});var t=e.target.files,a=t.length,s=[],n=function(){this.setState({files:s,isParsing:!1})}.bind(this);setTimeout(function(){for(var e=0;a>e;e++){var i=t[e],l=new FileReader,r=e;if(i.type.match("image.*")){var c=this.props.hasOwnProperty("maxWidth")?this.props.maxWidth:310,o=this.props.hasOwnProperty("maxHeight")?this.props.maxHeight:310;l.onload=function(e){var t=new Image;t.onload=function(e){var i=document.createElement("canvas"),l=t.width,m=t.height;l>m?l>c&&(m*=c/l,l=c):m>o&&(l*=o/m,m=o),i.width=l,i.height=m,i.getContext("2d").drawImage(t,0,0,l,m),s[r]=i.toDataURL("image/jpeg",.5),r+1==a&&n()},t.src=e.target.result},l.readAsDataURL(i)}else l.onload=function(e){s[r]=e.target.result},l.readAsDataURL(i)}}.bind(this),100)},handleUploadFiles:function(){this.setState({isUploading:!0,status:"",statusMessage:""});for(var e={},t=this.state,a=0;a<t.files.length;a++)e["file-"+a]=t.files[a];e._token=document.querySelector("meta[name='csrf-token']").getAttribute("value"),$.ajax({type:"POST",url:"/data/resources/upload",data:e,xhr:function(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total);this.setState({uploadProgress:t})}}.bind(this),!1),e}.bind(this),success:function(e){var t=e.hasOwnProperty("message")&&"object"==typeof e.message&&null!==e.message?e.message:{},s=Object.keys(t);this.setState({isUploading:!1,uploadProgress:0,files:[],resources:s,_storage:t,status:"success",message:"File(s) uploaded successfully!"},function(){var e=this.props;for(e.onChange(e.id,s),a=0;a<s.length;a++){var n=s[a];e.onStore(n,t[n])}}.bind(this))}.bind(this),error:function(e){this.setState({isUploading:!1,uploadProgress:0,status:"failure",message:"An error occurred during upload."})}.bind(this)})},handleRemoveResource:function(e){var t=this.state._storage,a=this.state.resources,s=a.indexOf(e);t.hasOwnProperty(e)&&delete t[e],-1!==s&&a.splice(s,1),this.setState({resources:a,_storage:t,status:"",message:""},function(){this.props.onChange(this.props.id,a)}.bind(this))},render:function(){var e,t,a=this.props,s=this.state,n=a.settings,i="",l=this.state.files,r=l.length,c=this.state.resources,o=this.state._storage,m=c.length;if(n.hasOwnProperty("accept")&&(i=n.accept.join()),s.status.length>0&&s.message.length>0){var u="success"==s.status?"success":"failure"==s.status?"danger":"info";t=React.createElement("div",{className:"alert alert-"+u},React.createElement("small",null,s.message))}if(m>0){var d=c.map(function(e,t){var a;return o.hasOwnProperty(e)&&o[e].hasOwnProperty("type")&&(a=o[e].type),React.createElement("div",{className:"list-group-item",key:["file-",e,"-",t].join()},React.createElement("span",{className:"label label-default m-r"},e),React.createElement("small",null,a),React.createElement("button",{onMouseUp:this.handleRemoveResource.bind(this,e),className:"close pull-right"},"×"))}.bind(this));e=React.createElement("div",{className:"card"},React.createElement("ul",{className:"list-group list-group-flush"},d))}else if(s.isUploading)e=React.createElement("div",null,React.createElement("h6",{className:"text-muted text-center m-t"},"Uploading ",r," ",1===r?"file":"files","..."),React.createElement("progress",{className:"progress",value:s.uploadProgress,max:100},React.createElement("div",{className:"progress"},React.createElement("span",{className:"progress-bar",style:{width:s.uploadProgress+"%"}},s.uploadProgress,"%"))));else{var p;(r>0||s.isParsing)&&(p=React.createElement("div",null,React.createElement("button",{type:"button",disabled:s.isParsing,className:"btn btn-sm btn-primary btn-block",onClick:this.handleUploadFiles},"⇑"," ",s.isParsing?"Preparing files...":"Upload"))),e=React.createElement("div",null,React.createElement("label",{className:"file"},React.createElement("input",{type:"file",className:"form-control",accept:i,onChange:this.onFileInputChange}),React.createElement("span",{className:"file-custom"},r>0?r+" files - ":"")),p)}return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},a)),React.createElement("div",{className:Fields.inputColumnClasses},e,t))}}),Fields.Header=React.createClass({displayName:"Header",render:function(){var e,t=this.props;return t.hasOwnProperty("description")&&null!==e&&(e=React.createElement("small",{className:"text-muted"},t.description)),React.createElement("div",{className:"form-group row"},React.createElement("h3",{className:"forcept-fieldset-header"},t.name," ",e),React.createElement("hr",null))}}),Fields.Number=React.createClass({displayName:"Number",onNumberInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("input",{type:"number",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onNumberInputChange})))}}),Fields.Pharmacy=React.createClass({displayName:"Pharmacy",getInitialState:function(){return{data:{}}},updateList:function(){$.ajax({type:"GET",url:"/data/pharmacy/drugs",success:function(e){"success"==e.status&&(__debug(e.data),this.setState({data:e.data}))}.bind(this),error:function(){},complete:function(){}})},componentWillMount:function(){this.updateList()},onSelectedDrugsChange:function(e){for(var t=e.target.options,a=[],s=0;s<t.length;s++)t[s].selected&&a.push(t[s].value);this.props.onChange(this.props.id,a)},render:function(){var e=this.props,t=this.state,a=Object.keys(this.state.data),s=React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment..."),React.createElement("div",null,"loading the latest pharmacy data"));return a.length>0&&(s=React.createElement("select",{className:"form-control forcept-field-select-drugs",multiple:!0,size:10,onChange:this.onSelectedDrugsChange},a.map(function(e,a){var s=t.data[e];if(s.hasOwnProperty("settings")&&s.settings.hasOwnProperty("options")&&null!==s.settings.options){var n=Object.keys(s.settings.options);return React.createElement("optgroup",{key:s.name,label:s.name},n.map(function(e,t){var a=s.settings.options[e],n="false"==a.available,i=a.value+(parseInt(a.count)>0&&a.available?"— "+a.count:"");return n?void 0:React.createElement("option",{value:a.value,key:t},i)}.bind(this)))}}.bind(this)))),React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},e)),React.createElement("div",{className:Fields.inputColumnClasses},s))}}),Fields.Resource=React.createClass({displayName:"Resource",getInitialState:function(){return{isFetching:!1,resource:{}}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("resource")&&null!==e.resource&&"object"==typeof e.resource&&(e.resource.hasOwnProperty("data")||this.fetchData(),this.setState({resource:e.resource}))},fetchData:function(){var e=this.props,t=this.state;this.setState({isFetching:!0}),$.ajax({method:"GET",url:"/data/resources/fetch?id="+e.id,success:function(e){var a=t.resource;a.type=e.type,a.base64=e.base64,this.setState({isFetching:!1,resource:a})}.bind(this),error:function(e){}.bind(this)})},render:function(){var e=this.props,t=this.state;resource=t.resource;var a,s=function(){a="Loading"};if(null!==resource&&"object"==typeof resource)if(t.isFetching)s();else if(resource.hasOwnProperty("type")){var n=resource.type;if(n.match("image/*"))if(resource.hasOwnProperty("base64"))try{a=React.createElement("img",{src:resource.base64})}catch(i){a="error!"}else s()}return React.createElement("div",{className:"forcept-patient-photo-contain "+(e.hasOwnProperty("className")?e.className:"")},a)}}),Fields.Select=React.createClass({displayName:"Select",getInitialState:function(){return{isCustomDataOptionSelected:!1,customDataDefaultValue:""}},componentWillMount:function(){var e,t,a=this.props,s=[];a.multiple!==!0&&(a.settings.hasOwnProperty("options")?(e=a.settings.options,t=Object.keys(e)):(e={},t=[]),t.map(function(t){s.push(e[t].value)}),"string"==typeof a.defaultValue&&-1===s.indexOf(a.defaultValue)&&this.setState({isCustomDataOptionSelected:!0,customDataDefaultValue:a.defaultValue}))},onSelectInputChange:function(e){var t=this.props;if(t.multiple===!0){for(var a=e.target.options,s=[],n=0;n<a.length;n++)a[n].selected&&s.push(a[n].value);t.onChange(t.id,s)}else switch(e.target.value){case"__default__":this.setState(this.getInitialState()),t.onChange(t.id,"");break;case"__custom__":this.setState({isCustomDataOptionSelected:!0}),t.onChange(t.id,"");break;default:this.setState(this.getInitialState()),t.onChange(t.id,e.target.value)}},onCustomDataInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){var e,t,a,s,n,i,l,r=this.props,c=this.state;r.settings.hasOwnProperty("options")?(e=r.settings.options,t=Object.keys(e)):(e={},t=[]),r.multiple===!1&&(n=React.createElement("option",{value:"__default__",disabled:!0},"Choose an option…"),isTrue(r.settings.allowCustomData)&&(i=React.createElement("option",{value:"__custom__"},"Enter custom data for this field »")),isTrue(c.isCustomDataOptionSelected)&&(l=React.createElement("input",{type:"text",className:"form-control",placeholder:"Enter custom data here",onChange:this.onCustomDataInputChange,defaultValue:c.customDataDefaultValue}))),a=t.map(function(t,a){var s=!1,n=r.settings.options[t];return n.hasOwnProperty("available")&&(s="false"===n.available),React.createElement("option",{value:e[t].value,key:this.props.id+"-option-"+a,disabled:s},e[t].value)}.bind(this));var o=r.multiple?t.length>30?30:t.length:1,m=c.customDataDefaultValue.length>0?"__default__":null!==r.defaultValue?r.defaultValue:r.multiple?[]:"__default__";return s=React.createElement("select",{className:"form-control",onChange:this.onSelectInputChange,defaultValue:m,multiple:r.multiple,size:o},n,a,i),React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},r)),React.createElement("div",{className:Fields.inputColumnClasses},s,l))}}),Fields.Text=React.createClass({displayName:"Text",onTextInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("input",{type:"text",className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onTextInputChange})))}}),Fields.Textarea=React.createClass({displayName:"Textarea",onTextareaInputChange:function(e){this.props.onChange(this.props.id,e.target.value)},render:function(){return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},this.props)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("textarea",{className:"form-control",autoComplete:"off",maxLength:"255",id:this.props.id,placeholder:this.props.name+" goes here",defaultValue:null!==this.props.defaultValue?this.props.defaultValue:null,onChange:this.onTextareaInputChange})))}}),Fields.YesNo=React.createClass({displayName:"YesNo",getInitialState:function(){return{yes:null}},componentWillMount:function(){var e=this.props;e.hasOwnProperty("defaultValue")&&null!==e.defaultValue&&-1!==["yes","no"].indexOf(e.defaultValue.toLowerCase())&&this.setState({yes:"yes"==e.defaultValue.toLowerCase()})},onYesNoInputChange:function(e){return function(t){this.setState({yes:e}),this.props.onChange(this.props.id,e?"Yes":"No")}.bind(this)},render:function(){var e=this.props,t=this.state;return React.createElement("div",{className:"form-group row"},React.createElement(Fields.FieldLabel,React.__spread({},e)),React.createElement("div",{className:Fields.inputColumnClasses},React.createElement("div",{className:"btn-group btn-group-block","data-toggle":"buttons"},React.createElement("label",{className:"btn btn-primary-outline"+(1==t.yes?" active":""),onClick:this.onYesNoInputChange(!0)},React.createElement("input",{type:"radio",name:e.name+"-options",autoComplete:"off",defaultChecked:1==t.yes}),"Yes"),React.createElement("label",{className:"btn btn-primary-outline"+(0==t.yes?" active":""),onClick:this.onYesNoInputChange(!1)},React.createElement("input",{type:"radio",name:e.name+"-options",autoComplete:"off",defaultChecked:0==t.yes}),"No"))))}});var FlowEditor=React.createClass({displayName:"FlowEditor",getInitialState:function(){return{fields:{},fieldValidities:{},invalidCount:0,isValid:!0,fieldsRemoved:[]}},componentWillMount:function(){this.setState({fields:this.props.fields},function(){this.checkContainerValidity()}.bind(this))},handleAddNewField:function(){var e=this.state.fields,t=this.state.fieldValidities,a=(new Date).getTime();e[a]=FlowEditor.getDefaultFieldState(this.props.stageType),t[a]=!1,this.setState({fields:e,fieldValidities:t}),this.checkContainerValidity()},handleRemoveField:function(e){var t=this.state.fields,a=this.state.fieldValidities,s=this.state.fieldsRemoved;t.hasOwnProperty(e)&&(s.push((this.refs[e].state.name.length>0?this.refs[e].state.name:"<em>Untitled field</em>")+" &nbsp; <span class='label label-default'>"+e+"</span>"),delete t[e]),a.hasOwnProperty(e)&&delete a[e],this.setState({fields:t,fieldValidities:a,fieldsRemoved:s}),this.checkContainerValidity()},handleConfigUpload:function(e){var t=new FileReader,a=e.target.files[0];t.onload=function(e){var t=JSON.parse(atob(e.target.result.split(",")[1]));t&&this.setState({fields:t})}.bind(this),t.readAsDataURL(a)},checkFieldValidity:function(e){var t=this.state.fieldValidities;t[e]=this.refs[e].isValid(),this.setState({fieldValidities:t}),this.checkContainerValidity()},checkContainerValidity:function(){var e=!0,t=0;for(var a in this.state.fieldValidities)this.state.fieldValidities[a]!==!0&&(t++,e=!1);this.setState({invalidCount:t,isValid:e})},compileData:function(){var e={};return Object.keys(this.state.fields).map(function(t,a){e[t]=this.refs[t].state}.bind(this)),e},clearRemoved:function(){this.setState({fieldsRemoved:[]})},render:function(){var e;return e=Object.keys(this.state.fields).length>0?Object.keys(this.state.fields).map(function(e,t){return React.createElement(FlowEditor.Field,React.__spread({},this.state.fields[e],{stageType:this.props.stageType,key:e,"data-key":e,ref:e,index:t,onChange:this.checkFieldValidity.bind(this,e),onRemove:this.handleRemoveField.bind(this,e)}))}.bind(this)):React.createElement("div",{className:"alert alert-info"},"No fields added — try ",React.createElement("a",{className:"alert-link",onClick:this.handleAddNewField},"adding a new one"),"."),React.createElement("div",null,React.createElement("h4",{className:"p-t"},"Field configuration",React.createElement("div",{className:"btn-group btn-group-sm pull-right"},React.createElement("label",{htmlFor:"uploadConfig",className:"btn btn-primary-outline"},"Upload config"),React.createElement("input",{type:"file",id:"uploadConfig",style:{display:"none"},onChange:this.handleConfigUpload,accept:".json"}),React.createElement("a",{href:"/data/flow/download?stage="+encodeURIComponent(this.props.stageName)+"&fields="+window.btoa(JSON.stringify(this.state.fields)),target:"_blank",className:"btn btn-primary-outline"},"Download config"))),React.createElement("hr",null),React.createElement("div",{id:"flow-editor-fields-contain"},e,React.createElement("button",{type:"button",className:"btn btn-primary btn-lg",onClick:this.handleAddNewField},"Add a new field"),React.createElement("button",{type:"button",className:"btn btn-success btn-lg",onClick:this.props.handleSubmit,disabled:!this.state.isValid},this.state.isValid?"Submit changes":this.state.invalidCount+" field(s) need attention before submitting")))}});FlowEditor.customizableFields=["select","multiselect","file","date"],FlowEditor.disableTypeChanges=["multiselect","file"],FlowEditor.getDefaultFieldState=function(e){switch(e){case"pharmacy":return{name:"",type:"multiselect",mutable:!0,settings:{options:{},allowCustomData:!1}};default:return{name:"",type:"text",mutable:!0,settings:{}}}},FlowEditor.getDefaultOptionState=function(e){switch(e){case"pharmacy":return{value:"",count:0,available:!1};default:return{value:""}}},FlowEditor.Field=React.createClass({displayName:"Field",getInitialState:function(){return FlowEditor.getDefaultFieldState(this.props.stageType)},componentWillMount:function(){var e=this.props;this.setState({name:e.name,type:e.type,mutable:isTrue(e.mutable),description:e.hasOwnProperty("description")?e.description:null,settings:-1!==FlowEditor.customizableFields.indexOf(e.type)&&e.hasOwnProperty("settings")&&"object"==typeof e.settings&&Object.keys(e.settings).length>0?e.settings:null})},handleFieldNameChange:function(e){this.setState({name:e.target.value},function(){this.props.onChange(this.props["data-key"])})},handleFieldTypeChange:function(e){this.setState({type:e.target.value},function(){this.props.onChange(this.props["data-key"])})},handleFieldDescriptionChange:function(e){this.setState({description:e.target.value},function(){this.props.onChange(this.props["data-key"])})},handleRemoveField:function(){this.props.onRemove(this.props.key)},handleFieldSettingsChange:function(){var e=this.refs["settings-"+this.props["data-key"]].state;this.setState({settings:e})},isValid:function(){var e=!0;return 0==this.state.name.length&&(e=!1),e},render:function(){var e,t,a,s,n;return-1!==FlowEditor.disableTypeChanges.indexOf(this.state.type)&&(a=React.createElement("div",{className:"alert alert-info"},"Once created, the ",React.createElement("strong",null,this.state.type)," field type cannot be changed to any other type.")),"pharmacy"==this.props.stageType?(s="Category",n="categories"):(s="Input",n="inputs",t=React.createElement("div",{className:"form-group"},React.createElement("label",{className:"form-control-label"},"Type:"),React.createElement("select",{className:"form-control",disabled:!this.state.mutable||-1!==FlowEditor.disableTypeChanges.indexOf(this.state.type),onChange:this.handleFieldTypeChange,defaultValue:this.state.type},React.createElement("optgroup",{label:"Inputs"},React.createElement("option",{value:"text"},"Text input"),React.createElement("option",{value:"textarea"},"Textarea input"),React.createElement("option",{value:"number"},"Number input"),React.createElement("option",{value:"date"},"Date input")),React.createElement("optgroup",{label:"Multiple-option fields"},React.createElement("option",{value:"select"},"Select input with options"),React.createElement("option",{value:"multiselect"},"Multi-select input with options"),React.createElement("option",{value:"file"},"File input"),React.createElement("option",{value:"yesno"},"Yes or no buttons")),React.createElement("optgroup",{label:"Other"},React.createElement("option",{value:"header"},"Group fields with a header"),React.createElement("option",{value:"pharmacy"},"Pharmacy - show available medication"))),a)),0==this.state.name.length?nameInputGroup=React.createElement("div",{className:"form-group has-error"},React.createElement("label",{className:"form-control-label",htmlFor:"name-"+this.props["data-key"]},"Name:"),React.createElement("input",{type:"text",id:"name-"+this.props["data-key"],className:"form-control form-control-error",placeholder:s+" name",maxLength:"100",onChange:this.handleFieldNameChange,defaultValue:this.state.name}),React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Heads up:")," all ",n," require a name.")):nameInputGroup=React.createElement("div",{className:"form-group"},React.createElement("label",{className:"form-control-label",htmlFor:"name-"+this.props["data-key"]},"Name:"),React.createElement("input",{type:"text",id:"name-"+this.props["data-key"],className:"form-control",placeholder:"Field name",maxLength:"100",onChange:this.handleFieldNameChange,defaultValue:this.state.name})),null!==this.state.description&&this.state.description.length>0&&(e=this.props.description),React.createElement("div",{"data-key":this.props["data-key"],"data-index":this.props.index,className:"row flow-editor-configurator-row p-t"},React.createElement("div",{className:"col-xs-12"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-12 col-md-10"},React.createElement("h4",{className:"field-title"},React.createElement("span",{className:"label label-info"},"#",this.props.index+1),React.createElement("span",{className:"label label-default"},this.props["data-key"]),React.createElement("span",{className:"title hidden-lg-down"},React.createElement("small",null,this.state.name.length>0?this.state.name:"pharmacy"==this.props.stageType?"Untitled category":"Untitled "+this.state.type+" input")))),React.createElement("div",{className:"col-sm-12 col-md-2"},React.createElement("h4",{className:"field-title m-b"},React.createElement("button",{type:"button",className:"btn btn-sm btn-danger-outline pull-right",disabled:!this.state.mutable,onClick:this.handleRemoveField},"× Remove"))))),React.createElement("div",{className:"col-sm-4 col-xs-12"},nameInputGroup,t,React.createElement("div",{className:"form-group"},React.createElement("label",{className:"form-control-label"},"Description:"),React.createElement("textarea",{className:"form-control",maxLength:"255",placeholder:"Enter a description here",onChange:this.handleFieldDescriptionChange,defaultValue:e}))),React.createElement("div",{className:"col-sm-8 col-xs-12"},React.createElement(FlowEditor.Field.Settings,{stageType:this.props.stageType,ref:"settings-"+this.props["data-key"],"field-key":this.props["data-key"],type:this.state.type,mutable:this.state.mutable,settings:this.state.settings,onChange:this.handleFieldSettingsChange})))}}),FlowEditor.Field.Settings=React.createClass({displayName:"Settings",getInitialState:function(){var e={};switch(this.props.type){case"date":e={useBroadMonthSelector:!1};break;case"select":e={options:{},allowCustomData:!1};break;case"multiselect":e={options:{}};break;case"file":e={accept:[]}}return e},componentWillMount:function(){switch(this.props.type){case"date":this.props.hasOwnProperty("settings")&&null!==this.props.settings&&this.props.settings.hasOwnProperty("useBroadMonthSelector")&&"true"==this.props.settings.useBroadMonthSelector&&this.setState({useBroadMonthSelector:"true"==this.props.settings.useBroadMonthSelector});break;case"select":this.props.hasOwnProperty("settings")&&null!==this.props.settings&&(this.props.settings.hasOwnProperty("options")&&this.setState({options:this.props.settings.options}),this.props.settings.hasOwnProperty("allowCustomData")&&"true"==this.props.settings.allowCustomData&&this.setState({
allowCustomData:"true"==this.props.settings.allowCustomData}));break;case"multiselect":this.props.hasOwnProperty("settings")&&null!==this.props.settings&&this.props.settings.hasOwnProperty("options")&&this.setState({options:this.props.settings.options});break;case"file":this.props.hasOwnProperty("settings")&&null!==this.props.settings&&this.props.settings.hasOwnProperty("accept")&&this.setState({accept:this.props.settings.accept})}},componentDidMount:function(){},handleAddOption:function(){var e=function(){var e=this.state.options;e[(new Date).getTime()]=FlowEditor.getDefaultOptionState(this.props.stageType),this.setState({options:e}),this.props.onChange(this.state)}.bind(this);this.state.hasOwnProperty("options")?e():this.setState(this.getInitialState(),function(){e()}.bind(this))},handleRemoveOption:function(e){var t=this.state.options;t.hasOwnProperty(e)&&delete t[e],this.setState({options:t},function(){this.props.onChange(this.state)}.bind(this))},handleChangeOptionPosition:function(e,t){return function(a){var s=this.state.options,n=Object.keys(s),i=s[t],l=n.indexOf(t);if(-1!==l){var r,c=n[l];switch(e){case"up":r=n[l-1];break;case"down":r=n[l+1]}var o=s[r];s[r]=i,s[c]=o,this.setState({options:s},function(){this.props.onChange(this.state)}.bind(this))}}.bind(this)},handleChangeOptionText:function(e){return function(t){var a=this.state.options;a.hasOwnProperty(e)&&(a[e].value=t.target.value),this.setState({options:a},function(){this.props.onChange(this.state)}.bind(this))}.bind(this)},handleAllowCustomDataChange:function(){var e=!this.state.allowCustomData;this.setState({allowCustomData:e},function(){this.props.onChange(this.state)})},handleBroadMonthSelectorChange:function(){var e=!this.state.useBroadMonthSelector;this.setState({useBroadMonthSelector:e},function(){this.props.onChange(this.state)})},handleChangeAllowedFiletypes:function(e){for(var t=e.target.options,a=[],s=0;s<t.length;s++)t[s].selected&&a.push(t[s].value);this.setState({accept:a},function(){this.props.onChange(this.state)}.bind(this))},handleDrugQuantityChange:function(e){return function(t){var a=this.state.options;a[e].count=parseInt(t.target.value),this.setState({options:a},function(){this.props.onChange(this.state)}.bind(this))}.bind(this)},handleDrugAvailabilityChange:function(e){return function(t){var a=this.state.options;a[e].available="true"==t.target.value,this.setState({options:a},function(){this.props.onChange(this.state)}.bind(this))}.bind(this)},render:function(){var e;switch(e=0==this.props.mutable?React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Notice:")," This field is protected. Only the display name and type-based settings can be modified."):React.createElement("span",null),this.props.type){case"text":case"textarea":case"number":case"yesno":case"header":case"pharmacy":return React.createElement("div",null,React.createElement("div",{className:"alert alert-info m-t"},"No configuration is required for ",this.props.type," inputs."),e);case"date":return React.createElement("div",{className:"form-group row"},React.createElement("div",{className:"col-sm-12"},React.createElement("h2",null,"Settings"),React.createElement("div",{className:"checkbox m-t"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:1==this.state.useBroadMonthSelector,onChange:this.handleBroadMonthSelectorChange}),"Use broad month selector instead of specific date selector")),e));case"select":case"multiselect":var t,a,s=function(){t=React.createElement("div",{className:"alert alert-info"},"No options have been defined — try ",React.createElement("a",{className:"alert-link",onClick:this.handleAddOption},"adding one"),".")};if(this.state.hasOwnProperty("allowCustomData")&&1==this.state.allowCustomData&&(a=React.createElement("div",{className:"col-sm-12"},React.createElement("div",{className:"checkbox m-t"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:1==this.state.allowCustomData,onChange:this.handleAllowCustomDataChange}),"Allow users to enter custom data for this field")))),this.state.hasOwnProperty("options")){var n=Object.keys(this.state.options);n.length>0?t=n.map(function(e,t){var a,s,i,l=this.state.options[e];0!==t&&(a=React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleChangeOptionPosition("up",e)},"↑")),t!==n.length-1&&(s=React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleChangeOptionPosition("down",e)},"↓"));var r;return"pharmacy"==this.props.stageType&&(r=isTrue(l.available)?React.createElement("span",{className:"label label-success col-sm-1"},"Check"):React.createElement("span",{className:"label label-default col-sm-1"},"x"),i=React.createElement("div",{className:"col-xs-11 col-sm-offset-1"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-6"},React.createElement("div",{className:"input-group input-group-sm"},React.createElement("input",{type:"number",className:"form-control",min:0,value:l.count,onChange:this.handleDrugQuantityChange(e)}),React.createElement("span",{className:"input-group-addon"},"qty in stock"))),React.createElement("div",{className:"col-xs-12 col-sm-6"},React.createElement("div",{className:"input-group input-group-sm"},React.createElement("span",{className:"input-group-addon"},"available"),React.createElement("select",{className:"form-control",defaultValue:l.available,onChange:this.handleDrugAvailabilityChange(e)},React.createElement("option",{value:!0},"Yes"),React.createElement("option",{value:!1},"No"))))))),React.createElement("div",{className:("pharmacy"!==this.props.stageType?"field-select-option ":"")+"form-group row",key:t},r,React.createElement("div",{className:"pharmacy"!==this.props.stageType?"col-sm-12":"col-sm-11"},React.createElement("div",{className:"input-group input-group-sm"},React.createElement("input",{type:"text",placeholder:"Enter a value for this option",className:"form-control",value:l.value,onChange:this.handleChangeOptionText(e)}),React.createElement("span",{className:"input-group-btn"},a,s,React.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleRemoveOption.bind(this,e)},React.createElement("span",null,"×"))))),i)}.bind(this)):s()}else s();return React.createElement("div",{className:"field-select-options-contain p-t"},React.createElement("h5",null,"pharmacy"==this.props.stageType?"Drugs in this category":"Options"," (",this.state.hasOwnProperty("options")?Object.keys(this.state.options).length:0,")"),t,a,e,React.createElement("button",{type:"button",className:"btn btn-primary-outline",onClick:this.handleAddOption},"Add another ","pharmacy"==this.props.stageType?"drug":"option"));case"file":return React.createElement("div",{className:"field-select-options-contain"},React.createElement("h5",null,"Accepted file types"),React.createElement("select",{className:"form-control",multiple:!0,onChange:this.handleChangeAllowedFiletypes,defaultValue:this.state.accept},React.createElement("option",{value:"image/*"},"image / *")),e);default:return React.createElement("div",null,React.createElement("div",{className:"alert alert-danger m-t"},'Unrecognized input type "',this.props.type,'"'),e)}}});var PatientsTable=React.createClass({displayName:"PatientsTable",getInitialState:function(){return{patients:{},name:"",forceptID:"",fieldNumber:""}},componentWillMount:function(){this.getPatients()},getPatients:function(e,t,a){e=e||"fetch";var s="fetch"===e?"GET":"POST";t=t||"",a=a||{},a._token=document.querySelector("meta[name='csrf-token']").getAttribute("value"),$.ajax({type:s,url:"/patients/"+e+"/"+t,data:a,success:function(e){for(var t=e.patients,a=Object.keys(t),s=0;s<a.length;s++)t[a[s]]=Utilities.applyGeneratedFields(t[a[s]]);this.setState({patients:t})}.bind(this)})},handleSearchNameChange:function(e){var t=e.target.value;0==t.length&&this.getPatients(),this.setState({name:t})},handleSearchForceptIDChange:function(e){var t=e.target.value;0==t.length&&this.getPatients(),this.setState({forceptID:t})},handleDoSearch:function(e){this.getPatients("search","",{by:e,"for":this.state[e]})},render:function(){var e,t=this.state.patients,a=Object.keys(t),s=a.length;return s>0&&(e=a.map(function(e,a){var s,n=t[e];if(n.hasOwnProperty("photo")&&null!==n.photo){var i=[];try{i=JSON.parse(n.photo)}catch(l){}i.length>0&&(s=React.createElement(Fields.Resource,{id:i[0],resource:{type:"image/jpeg"},className:"thumbnail"}))}else s="No photo";var r=React.createElement("em",null,"Checked out"),c=n.visits.length;return c>0&&n.hasOwnProperty("visit")&&null!==n.visit&&(r=React.createElement("a",{href:["/visits/stage/",n.visit.stage,"/handle/",n.visit.id].join("")},React.createElement("h4",null,React.createElement("span",{className:"label label-success"},n.visit.id," »")))),React.createElement("tr",null,React.createElement("td",{width:200},s),React.createElement("td",null,React.createElement("h4",null,React.createElement("span",{className:"label label-default"},n.id))),React.createElement("td",null,Utilities.getFullName(n)),React.createElement("td",null,n.visits.length),React.createElement("td",null,r),React.createElement("td",null,n.created_at),React.createElement("td",null,n.updated_at),React.createElement("td",null,React.createElement("a",{href:["/patients/view/",n.id].join("")},"»")))}.bind(this))),React.createElement("div",{className:"p-t"},React.createElement("h1",null,"Patients (",s,")"),React.createElement("fieldset",{className:"fieldset"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-4"},React.createElement("div",{className:"input-group"},React.createElement("input",{type:"text",className:"form-control",placeholder:"Search by first or last name...",onChange:this.handleSearchNameChange}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-primary",type:"button",onMouseUp:this.handleDoSearch.bind(this,"name")},"Search")))),React.createElement("div",{className:"col-xs-12 col-sm-4"},React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search by Forcept ID...",min:"100000",onChange:this.handleSearchForceptIDChange}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-primary",type:"button",onMouseUp:this.handleDoSearch.bind(this,"forceptID")},"Search")))),React.createElement("div",{className:"col-xs-12 col-sm-4"},React.createElement("div",{className:"input-group"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search by field number..."}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-primary",type:"button"},"Search")))))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 table-responsive"},React.createElement("table",{className:"table table-striped"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Photo"),React.createElement("th",null,"ID"),React.createElement("th",null,"Name"),React.createElement("th",null,"Visits"),React.createElement("th",null,"Location"),React.createElement("th",null,"Created at"),React.createElement("th",null,"Last updated"),React.createElement("th",null))),React.createElement("tbody",null,e)))))}}),StageVisits=React.createClass({displayName:"StageVisits",getInitialState:function(){return{isFetching:!0,visits:{}}},componentWillMount:function(){this.fetchVisits(),setInterval(function(){this.fetchVisits()}.bind(this),5e3)},fetchVisits:function(){$.ajax({type:"GET",url:"/visits/fetch/"+this.props.stage.id,success:function(e){e.hasOwnProperty("visits")?this.setState({visits:e.visits},function(){__debug(this.state)}.bind(this)):this.setState({visits:{}})}.bind(this),complete:function(e){this.setState({isFetching:!1})}.bind(this)})},render:function(){var e,t,a=Object.keys(this.state.visits);return e=a.length>0?a.map(function(e,t){var a=this.state.visits[e],s=a.patients.map(function(e,t){if(a.patient_models.hasOwnProperty(e.toString())){var s,n=a.patient_models[e.toString()],i="label-primary",l="Normal",r=function(){s=React.createElement("small",null,React.createElement("em",null,"No photo"))};if(n.hasOwnProperty("photo")&&null!==n.photo){var c=[];try{c=JSON.parse(n.photo)}catch(o){c=[]}Array.isArray(c)&&c.length>0?s=React.createElement(Fields.Resource,{id:c[0],resource:{type:"image/jpeg"},className:"thumbnail"}):r()}else r();if(n.hasOwnProperty("priority")&&null!==n.priority)switch(n.priority.toLowerCase()){case"high":l="High",i="label-warning";break;case"urgent":l="Urgent",i="label-danger"}var m=n.hasOwnProperty("full_name")?n.full_name:null,u=n.hasOwnProperty("birthday")?n.birthday:null,d=n.hasOwnProperty("created_at")?n.created_at:null,p=null!==m&&m.length>0?m:"Unnamed patient",h=null!==u&&u.length>0?Utilities.calculateAge(u):"Unknown",g=null!==d&&d.length>0?d:"Unknown";return React.createElement("div",{className:"col-xs-12 col-sm-6",key:"patient-row-"+e},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-block"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-4"},s),React.createElement("div",{className:"col-xs-12 col-sm-8 p-t text-xs-center text-sm-left"},React.createElement("div",null,React.createElement("span",{className:"label label-primary"},"#",t+1),React.createElement("span",{className:"label label-default"},e)),React.createElement("h4",{className:"forcept-stagevisits-patient-name"},p)))),React.createElement("ul",{className:"list-group list-group-flush"},React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-pill pull-right "+i},l),"Priority"),React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-primary label-pill pull-right"},h),"Age"),React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"label label-primary label-pill pull-right"},g),"Created"))))}return React.createElement("div",{className:"col-sm-12 col-md-4",key:"patient-col-"+e},React.createElement("div",{className:"card"},React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Uh oh:")," an error occurred.",React.createElement("br",null),React.createElement("em",null,"Missing data for patient ",e))))}.bind(a));return React.createElement("blockquote",{className:"blockquote",key:"visit-"+t},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12 col-sm-8"},React.createElement("h2",null,React.createElement("label",{className:"label label-default","data-toggle":"tooltip","data-placement":"top",title:"Visit ID"},a.id),"  ",a.patients.length," patient",1==a.patients.length?"":"s")),React.createElement("div",{className:"col-xs-12 col-sm-4"},React.createElement("a",{href:"/visits/stage/"+this.props.stage.id+"/handle/"+a.id,className:"btn btn-primary btn-block btn-lg"},"Handle visit #",a.id," »"))),React.createElement("div",{className:"row m-t"},s),React.createElement("hr",{className:"m-b-0"}))}.bind(this)):React.createElement("div",{className:"alert alert-info"},"There are currently no visits in this stage."),this.state.isFetching&&(t=React.createElement("img",{src:"/assets/img/loading.gif"})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-12"},React.createElement("h1",{className:"p-l text-xs-center"},this.props.stage.name,": ",this.state.visits.length," active visit",1==this.state.visits.length?"":"s"),React.createElement("hr",null),e,t))}}),Utilities={calculateAge:function(e){var t=+new Date(e),a=Date.now(),s=null;if(a>t){var n=~~((a-t)/315576e5);if(0===n){var i=(a-t)/26298e5;s=0!==~~i?i.toFixed(1)+" months":"<1 month"}else s=n+" years"}return s},applyGeneratedFields:function(e){var t=null;"string"==typeof e.first_name&&"string"==typeof e.last_name&&e.first_name.length>0&&e.last_name.length>0?t=e.first_name+" "+e.last_name:("string"==typeof e.first_name&&e.first_name.length>0&&(t=e.first_name),"string"==typeof e.last_name&&e.last_name.length>0&&(t=e.last_name)),e.full_name=t;var a=null,s=e.birthday;return"string"==typeof s&&s.length>0&&(a=Utilities.calculateAge(s)),e.age=a,e},getFullName:function(e){if(e.hasOwnProperty("full_name")&&null!==e.full_name&&e.full_name.length>0)return e.full_name;var t=[];return e.hasOwnProperty("first_name")&&null!==e.first_name&&e.first_name.length>0&&t.push(e.first_name),e.hasOwnProperty("last_name")&&null!==e.last_name&&e.last_name.length>0&&t.push(e.last_name),t.length>0?t.join(" "):"Unnamed Patient"},isTrue:function(e){switch(typeof e){case"boolean":return e===!0;case"string":return"true"===e;default:return!1}}},Visit=React.createClass({displayName:"Visit",getInitialState:function(){return{isSubmitting:!1,progress:0,confirmFinishVisitResponse:null,patients:{},resources:{},prescriptions:{}}},componentWillMount:function(){var e=this.props;if(e.hasOwnProperty("patients")&&null!==e.patients){var t={};for(var a in e.patients)t[a]=Utilities.applyGeneratedFields(e.patients[a]);this.setState({patients:t},function(){__debug(this.state.patients)}.bind(this))}},handleConfirmFinishVisit:function(e,t){var a=this.props;this.setState({isSubmitting:!0}),$("#visit-finish-modal").modal("hide").on("hidden.bs.modal",function(e){t.setState(t.getInitialState()),t.resetSelectState()}),$.ajax({type:"POST",url:"/visits/store",data:{_token:a._token,visit:a.visitID,patients:this.state.patients,stage:a.currentStage,destination:e},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.setState({progress:100*t})}}.bind(this),!1),e}.bind(this),success:function(e){this.setState(this.getInitialState())}.bind(this),error:function(e){},complete:function(e){this.setState({confirmFinishVisitResponse:e.responseJSON})}.bind(this)})},handlePatientAdd:function(e){var t=this.state.patients;t.hasOwnProperty(e.id)||(t[e.id]=Utilities.applyGeneratedFields(e),this.setState({confirmFinishVisitResponse:null,patients:t}))},handleFinishVisit:function(e){$("#visit-finish-modal").modal("show")},topLevelPatientStateChange:function(e,t,a){if(this.state.patients.hasOwnProperty(e)){var s=this.state.patients;patient=s[e],patient[t]=a,patient=Utilities.applyGeneratedFields(patient),this.setState({patients:s})}},topLevelStoreResource:function(e,t){var a=this.state.resources;a[e]=t,this.setState({resources:a})},render:function(){var e=this.props,t=this.state;return React.createElement("div",{className:"row"},React.createElement(Visit.FinishModal,{stages:e.stages,onConfirmFinishVisit:this.handleConfirmFinishVisit}),React.createElement(Visit.PatientsOverview,{fields:e.patientFields,patients:t.patients,mini:!1,resources:t.resources}),React.createElement(Visit.PatientsContainer,{_token:e._token,controlsType:e.controlsType,containerTitle:e.containerTitle,stageType:e.currentStageType,summaryFields:e.summaryFields,fields:e.mutableFields,patients:t.patients,prescriptions:t.prescriptions,isSubmitting:t.isSubmitting,progress:t.progress,confirmFinishVisitResponse:t.confirmFinishVisitResponse,onFinishVisit:this.handleFinishVisit,onPatientAdd:this.handlePatientAdd,onPatientDataChange:this.topLevelPatientStateChange,onStoreResource:this.topLevelStoreResource}))}});Visit.generatedFields={generatedHeader:{name:"Generated",type:"header"},age:{name:"Age",type:"number"}},Visit.PatientsContainer=React.createClass({displayName:"PatientsContainer",getInitialState:function(){return{showImportBlock:!1,isLoading:!1}},isLoading:function(e){this.setState({isLoading:e})},onFinishVisit:function(){this.isLoading(!0),this.props.onFinishVisit(this.isLoading(!1))},handlePatientAddfromScratch:function(e){var t;t=arguments.length>0&&null!==e&&"object"==typeof e?{_token:this.props._token,importedFieldData:e}:{_token:this.props._token},this.isLoading(!0),$.ajax({type:"POST",url:"/patients/create",data:t,success:function(e){"success"==e.status&&this.props.onPatientAdd(e.patient)}.bind(this),error:function(e){},complete:function(){this.isLoading(!1)}.bind(this)})},handlePatientAdd:function(e){e.hasOwnProperty("field_number")&&null!==e.field_number?this.handlePatientAddfromScratch(e):this.props.onPatientAdd(e)},handleShowImportBlock:function(){this.setState({showImportBlock:!0})},handleCloseImportBlock:function(){this.setState({showImportBlock:!1})},render:function(){var e,t,a,s=this.props,n=this.state,i=n.isLoading||s.isSubmitting,l=s.hasOwnProperty("patients")?s.patients:{},r=Object.keys(l),c=r.length;switch(s.isSubmitting?window.scrollTo(0,0):e=c>0?r.map(function(e,t){var a=l[e],n=React.createElement("div",{key:e},React.createElement(Visit.Patient,{patient:a,id:e,index:t,fields:s.fields,summaryFields:s.summaryFields,onPatientDataChange:s.onPatientDataChange,onStoreResource:s.onStoreResource}),React.createElement("hr",null));return n}.bind(this)):React.createElement("div",{className:"alert alert-info"},"There are currently no patients in this visit."),n.showImportBlock&&(t=React.createElement(Visit.ImportBlock,{_token:s._token,onPatientAdd:this.handlePatientAdd,onClose:this.handleCloseImportBlock})),s.controlsType){case"new-visit":a=React.createElement(Visit.NewVisitControls,{isLoading:i,isImportBlockVisible:n.showImportBlock,onFinishVisit:this.onFinishVisit,onPatientAddFromScratch:this.handlePatientAddfromScratch,onShowImportBlock:this.handleShowImportBlock});break;case"stage-visit":a=React.createElement(Visit.StageVisitControls,{isLoading:i,onFinishVisit:this.onFinishVisit})}var o;if(1==i)if(s.progress>0){var m=s.progress.toFixed(1);o=React.createElement("div",null,React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment...")),React.createElement("progress",{className:"progress progress-striped progress-animated",value:m,max:"100"},m,"%"))}else o=React.createElement("div",{className:"alert alert-info"},React.createElement("strong",null,"One moment..."));else{var u=s.confirmFinishVisitResponse;if(null!==u)if("success"==u.status){var d;"__checkout__"!==u.toStage&&(d=React.createElement("a",{href:"/visits/stage/"+u.toStage+"/handle/"+u.visitID,className:"btn btn-link"},"Follow this visit")),o=React.createElement("div",{className:"alert alert-success"},React.createElement("strong",null,"Awesome!")," ",u.message," ",d)}else{var p=u.errors.map(function(e,t){return React.createElement("li",{key:t},e)});o=React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"An error occurred:")," ",u.message,React.createElement("ul",null,p))}}return React.createElement("div",{className:"col-xs-12 col-sm-12 col-md-8 col-xl-9"},React.createElement("h1",{className:"p-t text-xs-center"},s.containerTitle),React.createElement("hr",null),o,e,t,a)}}),Visit.NewVisitControls=React.createClass({displayName:"NewVisitControls",handlePatientAddFromScratch:function(){return this.props.onPatientAddFromScratch(null)},render:function(){var e=this.props,t="m-x loading"+(0==e.isLoading?" invisible":"");return React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement("div",{className:"btn-group btn-group-lg p-b"},React.createElement("button",{type:"button",className:"btn btn-primary",disabled:e.isLoading,onClick:this.handlePatientAddFromScratch},"+"," New"),React.createElement("button",{type:"button",className:"btn btn-default",disabled:e.isLoading||e.isImportBlockVisible,onClick:e.onShowImportBlock},"↯"," Import")),React.createElement("div",{className:"btn-group btn-group-lg"},React.createElement("img",{src:"/assets/img/loading.gif",className:t,width:"52",height:"52"}),React.createElement("button",{type:"button",className:"btn btn-success",disabled:e.isLoading,onClick:e.onFinishVisit},"✓"," Finish visit")))}}),Visit.StageVisitControls=React.createClass({displayName:"StageVisitControls",render:function(){var e=this.props,t="m-x"+(0==e.isLoading?" invisible":"");return React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement("div",{className:"btn-group btn-group-lg"},React.createElement("img",{src:"/assets/img/loading.gif",className:t,width:"52",height:"52"}),React.createElement("button",{type:"button",className:"btn btn-success",disabled:e.isLoading,onClick:e.onFinishVisit},"Finish visit »")))}}),Visit.ImportBlock=React.createClass({displayName:"ImportBlock",getInitialState:function(){return{display:"form",patientsFound:[],name:null,forceptID:null,fieldNumber:null}},handleInputChange:function(e){return function(t){var a=this.state;a[e]=t.target.value,this.setState(a)}.bind(this)},handleSearch:function(e){this.setState({display:"searching"}),$.ajax({type:"POST",url:"/patients/search",data:{_token:this.props._token,by:e,"for":this.state[e]},success:function(e){this.setState({display:"results",patientsFound:e.patients})}.bind(this),error:function(e){},complete:function(e){}})},handlePatientAdd:function(e){return function(t){this.props.onPatientAdd(e),this.resetDisplay()}.bind(this)},resetDisplay:function(){this.setState(this.getInitialState())},doSearchName:function(){this.handleSearch("name")},doSearchForceptID:function(){this.handleSearch("forceptID")},doSearchFieldNumber:function(){this.handleSearch("fieldNumber")},render:function(){var e,t=this.state,a=this.props;switch(t.display){case"form":e=React.createElement("fieldset",{className:"form-group m-b-0"},React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by field number:"),React.createElement("div",{className:"input-group input-group-lg m-b"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search for a patient by field number...",value:t.fieldNumber,onChange:this.handleInputChange("fieldNumber")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.fieldNumber,onClick:this.doSearchFieldNumber},"Search"))),React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by Forcept ID:"),React.createElement("div",{className:"input-group input-group-lg m-b"},React.createElement("input",{type:"number",className:"form-control",placeholder:"Search for a patient by Forcept ID...",min:"100000",value:t.forceptID,onChange:this.handleInputChange("forceptID")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.forceptID,onClick:this.doSearchForceptID},"Search"))),React.createElement("label",{className:"form-control-label hidden-sm-up"},"...by first or last name:"),React.createElement("div",{className:"input-group input-group-lg"},React.createElement("input",{type:"text",className:"form-control",placeholder:"Search for a patient by first or last name...",value:t.name,onChange:this.handleInputChange("name")}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{className:"btn btn-secondary",type:"button",disabled:null==t.name||0==t.name.length,onClick:this.doSearchName},"Search"))));break;case"searching":e=React.createElement("h2",null,React.createElement("img",{src:"/assets/img/loading.gif",className:"m-r"}));break;case"results":e=0==t.patientsFound.length?React.createElement("div",{className:"alert alert-info"},"No patients found. ",React.createElement("a",{className:"alert-link",onClick:this.resetDisplay},"Try again?")):React.createElement("div",{className:"row"},t.patientsFound.map(function(e,t){var a,s=!1;return e.hasOwnProperty("current_visit")&&null!==e.current_visit?(s=!0,a=React.createElement("li",{className:"list-group-item bg-danger"},React.createElement("small",null,"Patient currently in a visit!"))):e.hasOwnProperty("used")&&null!==e.used&&e.used&&(a=React.createElement("li",{className:"list-group-item"},React.createElement("h6",null,"Note: this record is associated with the following user ID:"),React.createElement("span",{className:"label label-default"},e.used))),React.createElement("div",{className:"col-xs-12 col-sm-6",key:"patients-found-"+t},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-header"},React.createElement("h5",{className:"card-title"},React.createElement("span",{className:"label label-default pull-right"},e.hasOwnProperty("field_number")?e.field_number:e.id),React.createElement("span",{className:"label label-primary pull-right"},"#",t+1),React.createElement("span",{className:"title-content"},Utilities.getFullName(e)))),React.createElement("ul",{className:"list-group list-group-flush"},a),React.createElement("div",{className:"card-block"},React.createElement("button",{type:"button",className:"btn btn-block btn-primary",disabled:s,onClick:this.handlePatientAdd(e)},"+"," Add"))))}.bind(this)),React.createElement("div",{className:"col-xs-12 col-sm-6"},React.createElement("div",{className:"card"},React.createElement("div",{className:"card-block"},React.createElement("button",{type:"button",className:"btn btn-block btn-secondary",onClick:this.resetDisplay},"↵"," Go back")))))}return React.createElement("blockquote",{className:"blockquote"},React.createElement("h3",null,"↯"," Import a patient",React.createElement("button",{type:"button",className:"close pull-right","aria-label":"Close",onClick:a.onClose},React.createElement("span",{"aria-hidden":"true"},"×"))),React.createElement("hr",null),e)}}),Visit.FinishModal=React.createClass({displayName:"FinishModal",getInitialState:function(){return{isSubmitting:!1}},onComplete:function(){this.setState({isSubmitting:!0}),this.props.onConfirmFinishVisit(this.state.destination,this)},handleDestinationChange:function(e){return function(t){this.setState({destination:e})}.bind(this)},componentWillMount:function(){this.resetSelectState()},resetSelectState:function(){var e=this.props;e.hasOwnProperty("stages")&&null!==e.stages&&e.stages.length>0?this.setState({destination:e.stages[0].id}):this.setState({destination:"__checkout__"})},render:function(){var e,t,a,s=this.props,n=this.state,i={};return s.hasOwnProperty("stages")&&s.stages.length>0&&(e=s.stages.map(function(e,t){return i[e.id]=e.name,React.createElement("label",{className:"btn btn-secondary btn-block"+(e.id==n.destination?" active":""),key:"finish-modal-option"+t,onClick:this.handleDestinationChange(e.id)},React.createElement("input",{type:"radio",name:"destination",defaultChecked:e.id==n.destination}),e.id==n.destination?"✓":""," ",e.name)}.bind(this))),t=1==n.isSubmitting?"Working...":"__checkout__"==n.destination?"Check-out patients":"Move patients to "+(null!==n.destination?i[n.destination]:i[a]),React.createElement("div",{className:"modal fade",id:"visit-finish-modal"},React.createElement("div",{className:"modal-dialog modal-sm",role:"document"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},React.createElement("span",{"aria-hidden":"true"},"×")),React.createElement("h4",{className:"modal-title"},"Move visit to...")),React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"btn-group-vertical btn-group-lg",style:{display:"block"},"data-toggle":"buttons"},e,React.createElement("label",{className:"btn btn-secondary btn-block"+("__checkout__"==n.destination?" active":""),onClick:this.handleDestinationChange("__checkout__")},React.createElement("input",{type:"radio",name:"destination",defaultChecked:"__checkout__"==n.destination}),"__checkout__"==n.destination?"✓":""," Check-out"))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-success",
disabled:1==n.isSubmitting,onClick:this.onComplete},t)))))}}),Visit.PatientsOverview=React.createClass({displayName:"PatientsOverview",render:function(){var e,t,a=this.props,s=Object.keys(a.patients),n=s.length;return t=1==a.mini?jQuery.extend({},a.fields):jQuery.extend(jQuery.extend({},a.fields),Visit.generatedFields),delete t.first_name,delete t.last_name,delete t.photo,e=n>0?s.map(function(e,s){var n,i,l=a.patients[e];if(l.hasOwnProperty("photo")&&null!==l.photo){var r,c=a.hasOwnProperty("resources")?a.resources:{};try{if("string"==typeof l.photo)try{r=JSON.parse(l.photo)}catch(o){r=[]}else r=l.photo}catch(o){r=[]}if(r.length>0){var m=r[0];if(c.hasOwnProperty(m)){var u=c[m];i=React.createElement(Fields.Resource,{id:m,resource:{type:"image/jpeg",base64:u.data}})}else i=React.createElement(Fields.Resource,{id:m,resource:{type:"image/jpeg"}})}}a.mini===!1&&(n=React.createElement("span",null,React.createElement("div",{className:"card-header"},React.createElement("span",{className:"label label-info"},"#",s+1),React.createElement("span",{className:"label label-default"},e)),React.createElement("div",{className:"card-block"},React.createElement("h4",{className:"card-title text-xs-center m-a-0"},React.createElement("strong",null,Utilities.getFullName(l)))),i));var d=React.createElement("div",{className:"card forcept-patient-summary",key:e},n,React.createElement("div",{className:"list-group list-group-flush"},Object.keys(t).map(function(e,s){var n,i=t[e],r=!1,c=Visit.generatedFields.hasOwnProperty(e),o="No data";if(l.hasOwnProperty(e)&&null!==l[e]&&l[e].length>0){var m=l[e];if(1!=a.mini||!c)if(-1!==["string","number"].indexOf(typeof m)){r=!0;var u=i.type;switch(u){case"textarea":o=React.createElement("p",{dangerouslySetInnerHTML:{__html:m.replace(/\n/g,"<br/>")}});break;case"multiselect":case"pharmacy":var d;try{d=JSON.parse(m)}catch(p){d=[]}Array.isArray(d)&&d.length>0&&(o=d.join(", "));break;case"file":var d;try{d=JSON.parse(m)}catch(p){d=[]}o=d.map(function(e,t){return React.createElement(Fields.Resource,{id:e})});break;default:o=m.toString()}}else Array.isArray(m)&&(r=!0,o=m.join(", "))}return n=c?"➠":r?React.createElement("span",{className:"text-success"},"✓"):React.createElement("span",{className:"text-danger"},"✗"),"header"!=i.type?React.createElement("div",{className:"list-group-item",key:e+"-"+s},React.createElement("dl",null,React.createElement("dt",null,n,"   ",i.name),React.createElement("dd",null,r?o:""))):0==a.mini?React.createElement("div",{className:"list-group-item forcept-patient-overview-header-item",key:e+"-"+s},React.createElement("h5",{className:"text-center m-a-0"},i.name)):void 0}.bind(this))));return d}.bind(this)):React.createElement("div",{className:"alert alert-info hidden-sm-down"},"No patients within this visit."),1==a.mini?React.createElement("div",{className:"col-xs-12 col-lg-6"},e):React.createElement("div",{className:"col-xs-12 col-sm-12 col-md-4 col-xl-3"},e)}}),Visit.Patient=React.createClass({displayName:"Patient",handleFieldChange:function(e,t){this.props.onPatientDataChange(this.props.id,e,t)},handleStoreResource:function(e,t){this.props.onStoreResource(e,t)},render:function(){var e,t=this.props,a=(this.state,t.fields),s=Object.keys(a),n=(s.length,t.summaryFields),i=Object.keys(n),l=i.length,r=null!==t.patient.full_name?t.patient.full_name:"Unnamed patient";if(null!==n&&"object"==typeof n&&l>0){var c={},o={},m={};m[t.patient.patient_id]=t.patient,i.map(function(e,t){t>(l-1)/2?o[e]=n[e]:c[e]=n[e]}.bind(this)),e=React.createElement("div",{className:"row"},React.createElement(Visit.PatientsOverview,{fields:c,patients:m,mini:!0}),React.createElement(Visit.PatientsOverview,{fields:o,patients:m,mini:!0}))}var u=React.createElement("blockquote",{className:"blockquote"},React.createElement("h3",null,React.createElement("span",{className:"label label-info"},"#",t.hasOwnProperty("index")?t.index+1:"?"),React.createElement("span",{className:"label label-default"},t.hasOwnProperty("id")?t.id:"?"),"  ",React.createElement("span",{className:"hidden-xs-down"},r),React.createElement("div",{className:"hidden-sm-up p-t"},r)),e,React.createElement("hr",null),s.map(function(e,s){var n,i=a[e],l=t.patient,r=l.hasOwnProperty(e)?l[e]:null;switch(i.type){case"multiselect":case"file":case"pharmacy":if(null!==r&&"string"==typeof r)try{r=JSON.parse(r)}catch(c){r=[]}}switch(i.type){case"text":n=React.createElement(Fields.Text,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"textarea":n=React.createElement(Fields.Textarea,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"number":n=React.createElement(Fields.Number,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"date":n=React.createElement(Fields.Date,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"select":n=React.createElement(Fields.Select,React.__spread({},i,{multiple:!1,defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"multiselect":n=React.createElement(Fields.Select,React.__spread({},i,{multiple:!0,defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"file":n=React.createElement(Fields.File,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,onStore:this.handleStoreResource,key:e,id:e}));break;case"yesno":n=React.createElement(Fields.YesNo,React.__spread({},i,{defaultValue:r,onChange:this.handleFieldChange,key:e,id:e}));break;case"header":n=React.createElement(Fields.Header,React.__spread({},i,{key:e,id:e}));break;case"pharmacy":n=React.createElement(Fields.Pharmacy,React.__spread({},i,{onChange:this.handleFieldChange,key:e,id:e}));break;default:n=React.createElement("div",{className:"alert alert-danger"},React.createElement("strong",null,"Warning:")," Unrecognized input type ",i.type)}return n}.bind(this)));return u}});